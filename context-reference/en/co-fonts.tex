\startcomponent co-fonts
% we assume that there are fontfiles demofont.afm/pfb
%
% runtools mfonts.rb

% \loadmapfile[texnansi-test-test.map]

\environment contextref-env
\product contextref

% some typescript examples

\startbuffer[funny]
\definetypeface [funny] [rm] [serif] [palatino] [default] [encoding=texnansi]
\definetypeface [funny] [ss] [sans]  [palatino] [default] [encoding=texnansi]
\definetypeface [funny] [tt] [mono]  [palatino] [default] [encoding=texnansi]
\definetypeface [funny] [mm] [math]  [palatino] [default] [encoding=texnansi]
\stopbuffer

\startbuffer[joke]
\definetypeface [joke] [rm] [serif] [times]     [default] [encoding=texnansi]
\definetypeface [joke] [ss] [sans]  [helvetica] [default] [rscale=.9,
                                                           encoding=texnansi]
\definetypeface [joke] [tt] [mono]  [courier]   [default] [rscale=1.1,
                                                           encoding=texnansi]
\definetypeface [joke] [mm] [math]  [times]     [default] [encoding=texnansi]
\stopbuffer

\startbuffer[nojoke]
\definetypeface [nojoke] [rm] [serif] [times]     [default] [encoding=texnansi]
\definetypeface [nojoke] [ss] [sans]  [helvetica] [default] [encoding=texnansi]
\definetypeface [nojoke] [tt] [mono]  [courier]   [default] [encoding=texnansi]
\definetypeface [nojoke] [mm] [math]  [times]     [default] [encoding=texnansi]
\stopbuffer

\startbuffer[whow]
\definetypeface [whow] [rm] [serif] [modern] [latin-modern] [encoding=ec]
\definetypeface [whow] [ss] [sans]  [modern] [latin-modern] [encoding=ec]
\definetypeface [whow] [tt] [mono]  [modern] [latin-modern] [encoding=ec]
\definetypeface [whow] [mm] [math]  [modern] [latin-modern] [encoding=ec]
\stopbuffer

\getbuffer[funny,nojoke,joke,whow]

\chapter[fonts]{Fonts}
\index{font+definition}
\macro{\tex{startencoding}}
\macro{\tex{startmapping}}
\macro{\tex{definecharacter}}
\macro{\tex{defineaccent}}
\macro{\tex{definecommand}}
\macro{\tex{definecasemap}}
\macro{\tex{definebodyfont}}
\macro{\tex{definefont}}
\macro{\tex{definefontsynonym}}
\macro{\tex{definestyle}}

\section{Introduction}
\index{fonts}

This chapter will cover the details of defining fonts and collections
of fonts, called typefaces. We will also spend some words on
installing fonts. In any case, it helps if you know what a font is,
and are familiar with the \CONTEXT\ font switching macros.

The original \CONTEXT\ font model was based on plain \TEX,
but evolved into a more extensive one primarily aimed at
consistently typesetting our educational documents. The fact
that we had to typeset pseudo caps in any font shape in
normal text as well as superscript mode, has clearly
determined the design. This model has been relatively stable
since 1995.

Currently there are three layers of font definitions:

\startitemize

\item  simple font definitions: such definitions provide
       \type {\named} access to a specific font in a
       predefined size

\item  body font definitions: these result in a coherent
       set of fonts (often) from a same type foundry (or
       designer) that can be used intermixed

\item  typeface definitions: they package serif, sans serif,
       mono spaced and math and other styles in such a way
       that you can conveniently switch between different
       combinations

\stopitemize

These three mechanisms are actually build on top of each
other and all rely on a low level mapping mechanism
that is responsible for resolving the real font file name
and the specific font encoding used.

When \TEX\ users install one of the \TEX\ distributions,
like \TEX-live, they will have a lot of fonts already on the
system. Unfortunately it is not that easy to get a clear
picture of what is there and what is needed to use them.
Although the \type {texmf} tree is prepared for commercial
fonts, adding them is not trivial. To compensate this,
\CONTEXT\ comes with \type {texfont.pl}, that can install
fonts for you. Also, to help you on your way, we provide
typescripts for a couple of free fonts.


\section {Font files and synonyms}

In \CONTEXT, whenever possible you should define symbolic names for fonts.
The mapping from such symbolic names onto real font names can be done such
that it takes place unnoticed for the user. This is good since the name
depends on the encoding and therefore not seldom is obscure and hard to
remember. The trick is knowing how to use the \type{\definefontsynonym}
command.

\placefloat[][]{none}{\showsetup{definefontsynonym}}

The first argument is the synonym that is being defined (or, more often,
redefined). The second argument is the replacement of the synonym.  This
replacement can be a real font name, but it can also be another synonym.
The optional third argument can be used for a few font||specific settings.

There is no limit on the number of indirection levels, but the last one in
the chain has to be a valid font name. Font||specific settings actually
take place at that level, since they are closely related to specific
instances of fonts.  Any settings that are defined higher up in the chain
perculate down unless they are already defined at the lower level.

\startbuffer[synonymargs]
\vskip 1ex
\starttabulate[|lT|l|]
\NC encoding \NC the file encoding for \MKII\ fonts (TFM based) \NC \NR
\NC handling \NC the font handling for \MKII\ (see  previous chapter)\NC \NR
\NC features \NC the font handling for \MKIV\ and \XETEX\ (see previous chapter)\NC \NR
\NC mapping  \NC an obsolete method of specifying \XETEX\ font mappings \NC \NR
\stoptabulate
\vskip 1ex
\stopbuffer

\getbuffer[synonymargs]

Here is an example of the use of font synonyms:

\startexample
\starttyping
\definefontsynonym [Palatino] [uplr8t]   [encoding=ec]
\stoptyping
\stopexample

In this example, the file \type{uplr8t.tfm} is the real font, and it
contains the metrics for the Type~1 font URW Palladio L in EC encoding.
Now the name \type{Palatino} can be used in further font definitions to
indentify this font, instead of the dreadfully low||level (and hard to
remember) name \type{uplr8t} and its accompanying encoding.

A note on font names: In \PDFTEX, the real font is the name of the \TEX\
metrics file, minus the extension, as we saw already. In \XETEX\ and \MKIV\
a font name is a bit more complex, because in both cases OpenType fonts can
be accessed directly by their official font name as well as via the disk
file name.

In these two systems, \CONTEXT\ first attempts to find the font using the
official font name. If that doesn't work, then it tries to use the font by
file name as a fallback. Since this is not very efficient and also because
it may generate harmless but alarming|looking warnings|, it is possible to
force \CONTEXT\ into one or the other mode by using a prefix, so you will
most often see synonym definitions like this:

\startexample
\starttyping
\definefontsynonym [MSTimes]       [name:Times New Roman] [features=default]
\definefontsynonym [Iwona-Regular] [file:Iwona-Regular]   [features=default]
\stoptyping
\stopexample

In \XETEX, the \type{file} prefix implies that \XETEX\ will search for an
OpenType font (with extension \type{otf} or \type{ttf}) and if that fails
it will try to find a \TEX\ font (with extension \type{tfm}). In \MKIV, the
list is a little longer: OpenType (\type{otf}, \type{ttf}), Type~1
(\type{afm}), \OMEGA\ (\type{ofm}), and finally \TEX\ (\type{tfm}).

The use of aliases to hide the complexity of true font names is already
very useful, but \CONTEXT\ goes further than that.  An extra synonym level
is normally defined that maps this font name to a generic name like
\type{Serif} or \type{Sans}.

\startexample
\starttyping
\definefontsynonym [Serif] [Palatino]
\stoptyping
\stopexample

An important other advantage of using names like \type {Serif} in
definitions is, that we can easily remap this name onto a completely
different font than \type{Palatino}. This is often useful when you are
experimenting with a new environment file for a book or when you are
writing a \CONTEXT\ module.  

In fact, inside an environment file it is useful to go even further and
define new symbolic names that map onto \type {Serif}.

\starttyping
\definefontsynonym [TitleFont] [Serif]
\stoptyping

By using symbolic names in the main document and in style and macro
definitions, you can make them independent of a particular font and let
them adapt automatically to the main document fonts. That is of course
assuming these are indeed defined in terms of \type{Serif}, \type{Sans},
etcetera. All the \CONTEXT\ predefined typescripts are set up this way, and
you are very much encouraged to stick to the same logic for your own font
definitions as well.

The list of \quote{standard} symbolic names is given
in~\in{table}[tab:symbolic font names]

\startbuffer[symfontnames]
\vskip 1ex
\starttabulate[|lT|lT|l|]
\NC \rm\bf name          \NC \rm \bf style, alternative \NC \rm \bf explanation \NC \NR
\NC Blackboard           \NC --       \NC Used by the \type{\bbd}  macro \NC \NR
\NC Calligraphic         \NC --       \NC Used by the \type{\cal}  macro \NC \NR
\NC Fraktur              \NC --       \NC Used by the \type{\frak} macro \NC \NR
\NC Gothic               \NC --       \NC Used by the \type{\goth} macro \NC \NR
\NC OldStyle             \NC --       \NC Used by the \type{\os} macro   \NC \NR
\NC MPtxtfont            \NC --       \NC The default font for \METAPOST \NC \NR
\NC Calligraphy          \NC cg,tf    \NC \NC \NR
\NC Handwriting          \NC hw,tf    \NC \NC \NR
\NC MathRoman(Bold)      \NC mm,mr(bf)\NC \NC \NR
\NC MathItalic(Bold)     \NC mm,mi(bf)\NC \NC \NR
\NC MathSymbol(Bold)     \NC mm,sy(bf)\NC \NC \NR
\NC MathExtension(Bold)  \NC mm,ex(bf)\NC \NC \NR
\NC MathAlpha(Bold)      \NC mm,ma(bf)\NC \NC \NR
\NC MathBeta(Bold)       \NC mm,mb(bf)\NC \NC \NR
\NC MathGamma(Bold)      \NC mm,mc(bf)\NC \NC \NR
\NC MathDelta(Bold)      \NC mm,md(bf)\NC \NC \NR
\NC Mono                 \NC tt,tf    \NC \NC \NR
\NC MonoBold             \NC tt,bf    \NC \NC \NR
\NC MonoItalic           \NC tt,it    \NC \NC \NR
\NC MonoBoldItalic       \NC tt,bi    \NC \NC \NR
\NC MonoSlanted          \NC tt,sl    \NC \NC \NR
\NC MonoBoldSlanted      \NC tt,bs    \NC \NC \NR
\NC MonoCaps             \NC tt,sc    \NC \NC \NR
\NC Sans                 \NC ss,tf    \NC \NC \NR
\NC SansBold             \NC ss,bf    \NC \NC \NR
\NC SansItalic           \NC ss,it    \NC \NC \NR
\NC SansBoldItalic       \NC ss,bi    \NC \NC \NR
\NC SansSlanted          \NC ss,sl    \NC \NC \NR
\NC SansBoldSlanted      \NC ss,bs    \NC \NC \NR
\NC SansCaps             \NC ss,sc    \NC \NC \NR
\NC Serif                \NC rm,tf    \NC \NC \NR
\NC SerifBold            \NC rm,bf    \NC \NC \NR
\NC SerifItalic          \NC rm,it    \NC \NC \NR
\NC SerifBoldItalic      \NC rm,bi    \NC \NC \NR
\NC SerifSlanted         \NC rm,sl    \NC \NC \NR
\NC SerifBoldSlanted     \NC rm,bs    \NC \NC \NR
\NC SerifCaps            \NC rm,sc    \NC \NC \NR
\stoptabulate
\vskip 1ex
\stopbuffer

\placetable
  [here]
  [tab:symbolic font names]
  {Standard symbolic font names, and the style||alternative pair they belong to.}
  {\getbuffer[symfontnames]}


As mentioned earlier, the items in the third argument of
\type{\definefontsynonym} perculate down the chain of
synonyms. Occasionally, you may want to splice some settings into that
chain, and that is where \type{\setupfontsynonym} comes in handy. 

\showsetup{setupfontsynonym}

For example, the predefined \MKII\ typescripts for font handling that we saw in
the previous chapter contain a sequence of commands like this:

\startexample
\starttyping
\setupfontsynonym [Serif]       [handling=pure]
\setupfontsynonym [SerifBold]   [handling=pure]
\setupfontsynonym [SerifItalic] [handling=pure]
....
\stoptyping
\stopexample

\section {Simple font definitions}

The most simple font definition takes place with \type {\definefont}. 

\showsetup{definefont}

This macro defines a font with the same name as the first argument, you can
use it's identifier to select that font. The second argument works in the
same way as the second argument to \type{\definefontsynonym}: you can use
either a font synonym or a real font. There is an optional third argument
that can be either a bare number like \type{1.5 }, or a named setup
(see~\in{section}[sec:setups]). In case of a bare number, that is a local
setting for the interline space. In case of a setup, that setup can do
whatever it wants.

\startbuffer [dingbat]
\loadmapfile [koeieletters]
\definefont  [ContextLogo] [koeielogos at 72pt]
\ContextLogo \char 2
\stopbuffer

\startexample
\typebuffer[dingbat]
\stopexample

will result in 

\startreality
\getbuffer[dingbat]
\stopreality

If you want a fixed size font like in the example above, you can define a
font as follows:

\starttyping
\definefont [TitleFont] [Serif at 24pt]
\stoptyping

The \type {at} specifier is a natural \TEX\ one, just as \type
{scaled}. But where \type {at} is useful, \type {scaled} is rather useless,
since it scales the font related to its design size which is often unknown.
Depending on the design size is especially dangerous when you use symbolic
names, since different fonts have different design sizes, and designers
differ in their ideas about what a design size is. Compare for instance the
10pt instance of a Computer Modern Roman with Lucida Bright (which more
looks like a 12pt then).

\starttyping
\definefont [TitleFont] [Serif scaled 2400]
\stoptyping

Hard codes sizes can be annoying when you want to define
fonts in such a way that their definitions adapt themselves.
Therefore \CONTEXT\ provides an additional way of scaling:

\starttyping
\definefont [TitleFont] [Serif sa 2.4]
\stoptyping

The \type {sa} directive means as much as \quote {scaled at
the body font size}. Therefore this definition will lead to
a 24pt scaling when the (document) body font size equals
10pt. Because the definition has a lazy nature, the font
size will adapt itself to the current body font size.

Instead of a number, you can also use an identifier, as
defined in the body font environment that specifies related
dimensions. This scales the font to the \type {b} size,
being 1.440 by default.

\starttyping
\definefont [TitleFont] [Serif sa b]
\stoptyping

In fact, if you use a bare name like in 

\starttyping
\definefont [TitleFont] [Serif]
\stoptyping

that will internally be converted to

\starttyping
\definefont [TitleFont] [Serif sa *]
\stoptyping

which in turn expands into the current actual font size, after the
application of size corrections for super|| and subscripts etc. 

For example

\startbuffer[saex]
\definefont [TitleFont] [Sans]
{\TitleFont test } and {\tfc \TitleFont test }
\stopbuffer

\startexample
\typebuffer[saex]
\stopexample

gives

\startreality
\getbuffer[saex]
\stopreality

A specialized alternative to \type {sa} is \type {mo}. Here the size maps
onto an already remapped body font size. Such remappings are defined by the
macro \type{\mapfontsize}:

\showsetup{mapfontsize}

This remapping a dimension before applying scaling is sometimes handy for
math fonts, where you may want to use slightly different sizes than the
ones given in the body font environment. In the \CONTEXT\ distribution,
this happens only with the Math Times fonts, where the predefined
typescript contains the following lines:

\starttyping
\mapfontsize [5pt]    [6.0pt]
\mapfontsize [6pt]    [6.8pt]
\mapfontsize [7pt]    [7.6pt]
\mapfontsize [8pt]    [8.4pt]
\mapfontsize [9pt]    [9.2pt]
\mapfontsize [10pt]   [10pt]
\mapfontsize [11pt]   [10.8pt]
\mapfontsize [12pt]   [11.6pt]
\mapfontsize [14.4pt] [13.2pt]
\stoptyping

As we have seen, \type{\definefont} creates a macro name for a font
switch. For ease of use, there is also a direct method to access a 
font:

\showsetup{definedfont}

Where the argument has exactly the same syntax as the second argument to
\type{\definefont}. In fact, this macro executes \type{\definefont} 
internally, and then immediately switches to the defined font.


\section {Defining body fonts}

The core of this model is the definition command that is used
as follows:

\starttyping
\definebodyfont [10pt] [rm] [tf=tir at 10pt]
\stoptyping

As one can expect, the first implementation of a font model
in \TEX\ is also determined and thereby complicated by the
fact that the Computer Modern Roman fonts come in design
sizes. As a result, definitions can look rather complex and
because most \TEX\ users start with those fonts, font
definitions are considered to be complex.

Another complicating factor is that in order to typeset math,
even more definitions are needed. Add to that the fact that
sometimes we need to use fonts with mixed encodings, i.e.\
with the glyphs positioned in different font slots, and you
can understand why font handling in \TEX\ is often qualified
as \quote {the font mess}. Flexibility simply has its price.

Many documents have a rather simple design and use only a
couple of (often related) fonts. For some commonly used
fonts, this means that one can stick to loading the
appropriate predefined font definition file. \footnote {The
original font definition files are replaced by typescripts
in \type {type-pre}, but font files are still supported for
upward compatibility reasons.} But font life is seldom
simple and, in a worst case scenario, one must define
the fonts in the document style.

Because most fonts come in one design size, we can simplify
the definitions by using predefined sizes, like the default
one (type {sa 1}):

\starttyping
\definebodyfont [10pt,11pt,12pt] [rm] [default]
\stoptyping


Because the font names (may) depend on the encoding vector, we
can use the previously discussed method for mapping symbolic
names. So, one can comfortably say:

\starttyping
\definebodyfont [10pt,11pt,12pt] [rm] [tf=tir         sa 1]
\definebodyfont [10pt,11pt,12pt] [rm] [tf=Times-Roman sa 1]
\definebodyfont [10pt,11pt,12pt] [rm] [tf=Serif       sa 1]
\stoptyping

The default serif fonts are defined with:

\startbuffer[font-5]
\definebodyfont [default] [rm]
  [ tf=Serif        sa 1,
   tfa=Serif        sa a,
      ...
    sl=SerifSlanted sa 1,
   sla=SerifSlanted sa a,
      ...]
\stopbuffer

\typebuffer[font-5]

We saw that \type {\tf} is the default font. Here \type
{\tf} is defined as \typ{Serif sa 1} which means that it is
a serif font, scaled to a normal font size. This \type
{Serif} is projected elsewhere on for example \typ
{LucidaBright} which in turn is projected on the filename
\type {lbr}.

The kind of all||in||one definitions as shown previously for
Helvetica use the \type {default} settings and enable easy
font definitions. This is okay for fonts that come in one
design size.

We, like other \TEX\ users, started with the use of Computer
Modern Roman fonts. Since these fonts have specific design
sizes \CONTEXT\ supports accurate definitions. See the file
\type {font-cmr}:

\startbuffer[font-6]
\definebodyfont [12pt] [rm]
  [ tf=cmr12,
   tfa=cmr12 scaled \magstep1,
   tfb=cmr12 scaled \magstep2,
   tfc=cmr12 scaled \magstep3,
   tfd=cmr12 scaled \magstep4,
    bf=cmbx12,
    it=cmti12,
    sl=cmsl12,
    bi=cmbxti10 at 12pt,
    bs=cmbxsl10 at 12pt,
    sc=cmcsc10 at 12pt]
\stopbuffer

\typebuffer[font-6]

We use here the available \TEX||specifications \type
{scaled} and \type {at}, but \CONTEXT\ also supports a
combination of both: \type {sa} (scaled at). For example if
we do not want to use the default Helvetica definition we
define:

\startbuffer[font-7]
\definebodyfont [12pt,11pt,10pt,9pt,8pt] [ss]
  [tf=hv  sa 1.000,
   bf=hvb sa 1.000,
   it=hvo sa 1.000,
   sl=hvo sa 1.000,
  tfa=hv  sa 1.200,
  tfb=hv  sa 1.440,
  tfc=hv  sa 1.728,
  tfd=hv  sa 2.074,
   sc=hv  sa 1.000]
\stopbuffer

\typebuffer[font-7]

The scaling is done in relation to the bodyfont size. In
analogy with \TEX's \type {\magstep} we can use \type
{\magfactor}: instead of \type {sa 1.440} we specify \type
{sa \magfactor2}. Because typing all these numbers is rather
tiresome so we replace \type {1.200} by \type {a}, etc. The
relations between \type {a} and \type {1.200} can be set up
in the bodyfont environment.

\startbuffer[font-8]
\definebodyfont [12pt,11pt,10pt,9pt,8pt] [ss]
  [tf=hv sa 1, tfa=hv sa a, tfb=hv sa b, tfc=hv sa c, tfd=hv sa d]
\stopbuffer

\typebuffer[font-8]

Since font files are used in all interfaces we use English
commands. The definitions take place in files with the name
\type {font-<<xxx>>.tex}, see for example the file \type
{font-cmr.tex}.

\showsetup{definebodyfont}

The setups \type {ex}, \type {mi}, \type {sy}, \type {ms},
\type {mb} and \type {mc} relate to the math charactersets.
The first three we can also find in plain \TEX, the last
three are necessary in other font families. The symbols and
characters in \AMSTEX\ can also be used in \CONTEXT: \type
{\definebodyfont [ams]}. These can be found in \type {ma}
and \type {mb}.

The \type {a}||\type {d} are not mandatory. As an example we
will define a bigger fontsize of \type {\tf}:

\startbuffer
\definebodyfont [10pt,11pt,12pt] [rm] [tfe=Regular at 48pt]
\tfe Big Words.
\stopbuffer

\startexample
\typebuffer
\stopexample

This becomes:

\startreality
\startlinecorrection
\getbuffer
\stoplinecorrection
\stopreality

This definition brings us to other definitions. It is
possible to define a bodyfont in a several ways. We can use
classifications like \type {Regular}, or abstract names like
\type {TimesRoman}, or filenames, like \type {tir}, or even
fancy names like \type {HeadLetter}.

\starttyping
\definebodyfont[HeadLetter][Regular sa 1.2]
\stoptyping

After these definitions we can use \type {\HeadLetter} to
switch fonts. It may be necessary to adapt the interline
spacing with \type {\setupinterlinespace} like this:

\starttyping
\HeadLetter \setupinterlinespace text \par
\stoptyping

For advanced \TEX\ users there is the dimension||register
\type {\bodyfontsize}. This variable can be used to set
fontwidths. The number (rounded) points is available in
\type {\bodyfontpoints}.

As we already pointed out, the mapping from symbolic names
onto the real file name can be direct or indirect. The
indirect method has the advantage that one can also use the
more abstract name (\type {Serif}) as well as the real name
(\type {Times-Roman}), but can leave the file name
untouched. Document styles thereby can be defined in such a
way that they are independent of font file names. This
means that the previous definition can become:

\starttyping
\definebodyfont    [10pt,11pt,12pt] [rm] [tf=Serif sa 1]
\definefontsynonym [Serif] [Times-Roman]
\definefontsynonym [Times-Roman] [tir] [encoding=texnansi]
\stoptyping

These commands permit you to combine fonts in any way in
any size, but when documents have a more complicated
design, there may be many \type {Serif}'s and multiple math
fonts used. Of course this can be handled, but only by
redefining fonts on the spot and this is not only
cumbersome, but also undesirable from the perspective of
document source management.

\startbuffer[sample]
Who is {\it fond} of fonts?
Who claims that $t+e+x+t=m+a+t+h$?
Who {\ss can see} {\tt the difference} here?
\stopbuffer

Consider the following text:

\typebuffer[sample]

In Computer Modern Roman fonts, this looks like:

\bgroup
  \switchtobodyfont[cmr]
  \startlines
  \getbuffer[sample]
  \stoplines
\egroup

While in Lucida it shows up as:

\bgroup
  \switchtobodyfont[lbr]
  \startlines
  \getbuffer[sample]
  \stoplines
\egroup

The standard \POSTSCRIPT\ font have yet another look and feel:

\bgroup
  \switchtobodyfont[pos]
  \startlines
  \getbuffer[sample]
  \stoplines
\egroup

As you can notice, there are differences in size and shape.
The switch between those fonts was done by issuing the
following commands.

\starttyping
\switchtobodyfont[cmr]
\switchtobodyfont[lbr]
\switchtobodyfont[pos]
\stoptyping

This way of switching fonts has been part of \CONTEXT\ from
the beginning, but as more complicated designs started to
show up, we felt the need for a more versatile mechanism.

\section {Typescripts and typefaces}

On top of the existing (but extended) traditional font
module, we now provide a more abstract layer of typescripts
and building blocks for definitions and typefaces as font
containers. The original font definition files have been
regrouped into such typescripts thereby reducing the number
of files involved.

Typescripts are in fact just organized definitions. The
previously shown Lucida Bright font collection can be
defined as follows. First we map some symbolic names onto
Lucida names; the mapping to encoding specific filenames
takes place somewhere else.

\starttyping
\definefontsynonym [Serif]         [LucidaBright]
\definefontsynonym [SerifBold]     [LucidaBright-Demi]
....
\definefontsynonym [Sans]          [LucidaSans]
\definefontsynonym [SansBold]      [LucidaSans-Demi]
....
\definefontsynonym [Mono]          [LucidaSans-Typewriter]
\definefontsynonym [MonoBold]      [LucidaSans-TypewriterBold]
....
\definefontsynonym [MathRoman]     [LucidaBright]
\definefontsynonym [MathExtension] [LucidaNewMath-Extension]
\stoptyping

Because no design sizes are involved, we can define the
sizes in a rather fast way.

\starttyping
\definebodyfont
  [17.3pt,14.4pt,12pt,11pt,10pt,9pt,8pt,7pt,6pt,5pt,4pt]
  [rm,ss,tt,mm]
  [default]
\stoptyping

As you can see here, these definitions define the \type
{serif}, \type {sans}, \type {mono} and \type {math} shapes
together. In the typescript layer, these definitions are
split:

\starttyping
\starttypescript [serif] [lucida] [name]
  \definefontsynonym [Serif]     [LucidaBright]
  \definefontsynonym [SerifBold] [LucidaBright-Demi]
  ....
\stoptypescript
\stoptyping

In a similar way the sizes have become typescripts:

\starttyping
\starttypescript [serif] [default] [size]
  \definebodyfont
    [17.3pt,14.4pt,12pt,11pt,10pt,9pt,8pt,7pt,6pt,5pt,4pt]
    [rm] [default]
\stoptypescript
\stoptyping

The definition of the Lucida Bright font collection can now
be simplified to:

\starttyping
\starttypescript [lbr]
  \usetypescript [all] [lucida]  [name]
  \usetypescript [all] [default] [size]
\stoptypescript
\stoptyping

Typescripts and its invocations have up to three specifiers.
An invocation matches the script specification when the three
arguments have common keywords. The special keyword \type
{all} is equivalent to any match. Although any keyword is
permitted, the current definitions have some reserved
(advised) keys, like:

\starttabulate[|lT|p|]
\HL
\NC \bf pattern \NC \bf application \NC \NR
\HL
\NC [serif] [*] [*]   \NC serif fonts             \NC \NR
\NC [sans] [*] [*]    \NC sans serif fonts        \NC \NR
\NC [mono] [*] [*]    \NC mono spaced fonts       \NC \NR
\NC [math] [*] [*]    \NC math fonts              \NC \NR
\NC [*] [*] [size]    \NC size specification      \NC \NR
\NC [*] [*] [name]    \NC symbolic name mapping   \NC \NR
\NC [*] [*] [special] \NC special settings        \NC \NR
\NC [*] [*] [special] \NC special settings        \NC \NR
\NC [*] [default] [*] \NC default case(s)         \NC \NR
\NC [map] [*] [*]     \NC map file specifications \NC \NR
\HL
\stoptabulate

In many cases the font class or encoding is part of the
specification. These are variable.

\starttabulate[|lT|p|]
\HL
\NC \bf pattern \NC \bf application \NC \NR
\HL
\NC [*] [class] [*]    \NC a specific font class    \NC \NR
\NC [*] [*] [encoding] \NC a specific font encoding \NC \NR
\HL
\stoptabulate

When you take a close look at the files you will notice a
couple of more keywords, but we will not discuss them here.
Instead of the predefined size \type {default}, you can use
the \type {dtp} size scripts with their associated body font
environments.

In the example of the Lucida Bright definition, we still
treat the font as a whole: \type {serif}, \type {sans},
\type {mono} and \type {math} come from one family of
fonts. Instead of defining the font this way, we could have
created a so called typeface collection. Such a definition
looks as follows:

\typebuffer[funny]

From this moment, \type {\funny} will enable this specific
collection of fonts. In a similar way we can define a
collection \type {\joke}.


\typebuffer[joke]

And the familiar Computer Modern Roman as \type {\whow}:

\typebuffer[whow]

When typeset in \type {\funny}, \type {\joke}, and \type
{whow}, the samples now look like:

\startlines
{\funny \getbuffer[sample]}
\stoplines

\startlines
{\joke  \getbuffer[sample]}
\stoplines

\startlines
{\whow  \getbuffer[sample]}
\stoplines

With \type {\showbodyfont} you can get an overview of this font.

\placefigure
  {The \type {funny} typeface collection.}
  {\showbodyfont[funny]}

\placefigure
  {The \type {joke} typeface collection.}
  {\showbodyfont[joke]}

\placefigure
  {The \type {whow} typeface collection.}
  {\showbodyfont[whow]}

When defining the joke typeface collection, we used a scale
directive. The next sample demonstrates the difference
between the non scaled and the scaled alternatives.

\startlines
{\nojoke \getbuffer[sample]}
\stoplines

\startlines
{\joke   \getbuffer[sample]}
\stoplines

In due time \CONTEXT\ will come with more predefined typeface
collections. One of the currently predefined typefaces is
Computer Modern Roman:

\starttyping
\usetypescript[modern][ec]       % western european languages
\usetypescript[modern][texnansi] % western european languages
\usetypescript[modern][qx]       % eastern european languages
\usetypescript[modern][t5]       % vietnamese users
\stoptyping

Another set is made up by Adobe's standard 15 fonts:

\starttyping
\usetypescript[postscript][texnansi] % our prefered encoding
\usetypescript[postscript][ec]       % another popular one
\stoptyping

It may not be clear from the previous examples, but a big
difference between using typeface definitions and the old
method of redefining over and over again, is that the new
method uses more resources. This is because each typeface
gets its own name space assigned. As an intentional side
effect, the symbolic names also follow the typeface. This
means that for instance:

\startbuffer[big]
\definefont[MyBigFont][Serif sa 1.5] \MyBigFont A bit larger!
\stopbuffer

\typebuffer[big]

will adapt itself to the currently activated serif font
shape, here \type {\funny}, \type {\joke} and \type {\whow}.

\startlines
{\funny \getbuffer[big]}
{\joke  \getbuffer[big]}
{\whow  \getbuffer[big]}
\stoplines

The option to define relative font sizes using the \type
{rscale} parameter permits fine tuning of font sizes.
Fine tuning of the sizes \type {x}, \type {xx}, \type {a},
\type {b}, \unknown\ as well as interline spacing is handled
by the bodyfont environment. This command normally takes two
arguments, but accepts an optional (first) one denoting a
class. You can use this command to tailor the environment for
a specific typeface.

\startbuffer
\definebodyfontenvironment
  [joke] [11pt]
  [interlinespace=20pt]
\stopbuffer

\bgroup \joke Although the default interline space is quite
well tuned to the average font, you may want to change it
using this command. The defaults used to typeset this
paragraph are related to the x||height of the font. \par
\egroup

\typebuffer

\bgroup \getbuffer \joke However, keep in mind that when you
change the dimensions for one size, you also need to change
them for other sizes in order to get a consistent look and
feel when switching to a smaller or larger size. \par \egroup

Math is kind of special in the sense that it has its own set
of fonts, either or not related to the main text font. By
default, a change in style, for instance bold, is applied to
text only.

\startbuffer[math]
$        \sqrt{625} =     5\alpha$
$\bf     \sqrt{625} =     5\alpha$
$        \sqrt{625} = \bf 5\alpha$
$\bfmath \sqrt{625} =     5\alpha$
\stopbuffer

\typebuffer[math]

The difference between these four lines is as follows:

\startlines
\funny \getbuffer[math]
\stoplines

In order to get a bold $\alpha$ symbol, we need to define
bold math fonts. \footnote {Bold math is already prepared in
the core modules, so normally one can do with less code} The
most convenient way of doing this is the following:

\startbuffer
\definetypeface [funny] [mm]
  [math,boldmath] [palatino] [default] [encoding=texnansi]
\stopbuffer

\typebuffer \getbuffer

Bold math looks like this:

\startlines
\funny \getbuffer[math]
\stoplines

The definitions are given on the next page. Such definitions
are normally collected in the project bound file, for
instance called \type {typeface.tex}. You can add a filename
to the list of typescript files yourself:

\starttyping
\usetypescriptfile[typeface] % project scripts
\stoptyping

An example of such a file is shown below:

\start
\switchtobodyfont[9pt] \typefile{typeface}
\stop

It is also possible to avoid typescripts. When definitions are
used only once, it makes sense to use a more direct method.
We will illustrate this with a bit strange example.

Imagine that you want some math formulas to stand out, but
that you don't have bold fonts. In that case you can for
instance scale them. A rather direct method is the following.

\startbuffer
\definebodyfont
  [funny]
  [12pt,11pt,10pt,9pt,8pt,7pt] [mm]
  [mrbf=MathRoman     mo 2,
   exbf=MathExtension mo 2,
   mibf=MathItalic    mo 2,
   sybf=MathSymbol    mo 2]
\stopbuffer

\typebuffer \getbuffer

Our math sample will now look like:

\startlines
\funny \getbuffer[math]
\stoplines

We can also use an indirect method:

\startbuffer
\definebodyfont
  [smallmath] [mm]
  [mrbf=MathRoman     mo .5,
   exbf=MathExtension mo .5,
   mibf=MathItalic    mo .5,
   sybf=MathSymbol    mo .5]

\definebodyfont
  [funny]
  [12pt,11pt,10pt,9pt,8pt,7pt]
  [mm] [smallmath]
\stopbuffer

\typebuffer \getbuffer

This method is to be preferred when we have to define more
typefaces since it saves keystrokes.

\startlines
\funny \getbuffer[math]
\stoplines

For efficiency reasons, the font definitions (when part of
a typeface) are frozen the first time they are used. Until
that moment definitions will adapt themselves to changes in
for instance scaling and (mapped) names. Freezing
definitions is normally no problem because typefaces are
defined for a whole document and one can easily define
more instances. When you redefine it, a frozen font is
automatically unfrozen.

\section{Predefined font, style and alternative keywords}

We once again return to font definitions. Fast fontswitching
is done with commands like \type {\xii} or \type
{\twelvepoint}, which is comparable to the way it is done in
plain \TEX. These commands are defined with:

\startbuffer[font-10]
\definefontsynonym [twelvepoint] [12pt]
\definefontsynonym [xii]         [12pt]
\stopbuffer

\typebuffer[font-10]

The keys in \type {\setupbodyfont} are defined in terms of:

\startbuffer[font-11]
\definefontstyle [rm,roman,serif,regular]    [rm]
\definefontstyle [ss,sansserif,sans,support] [ss]
\definefontstyle [tt,teletype,type,mono]     [tt]
\definefontstyle [hw,handwritten]            [hw]
\definefontstyle [cg,calligraphic]           [cg]
\stopbuffer

\typebuffer[font-11]

In many command setups we encounter the parameter \type
{style}. In those situations we can specify a key. These
keys are defined with \type {\definestyle}. The third
argument is only of importance in chapter and section
titles, where, apart from \type {\cap}, we want to obey the
font used there.

\startbuffer[font-12]
\definestyle [normal]                  [\tf]  []
\definestyle [bold]                    [\bf]  []
\definestyle [type]                    [\tt]  []
\definestyle [italic]                  [\it]  []
\definestyle [slanted]                 [\sl]  []
\definestyle [bolditalic,italicbold]   [\bs]  []
\definestyle [boldslanted,slantedbold] [\bs]  []
\definestyle [small,smallnormal]       [\tfx] []
\stopbuffer

\typebuffer[font-12]

In \in{section}[emphasize] we have already explained how
{\em emphasizing} is defined. With oldstyle digits this is
somewhat different. We cannot on the forehand in what font
these can be found. By default we have the setup:


\startbuffer[font-13]
\definefontsynonym [OldStyle] [MathItalic]
\stopbuffer

\typebuffer[font-13]

As we see they are obtained from the same font as the math
italic characters.

In addition to these commands there are others, for example
macros for manipulating accents. These commands are
discussed in the file \type {font-ini}. More information can
also be found in the file \type {core-fnt} and specific
gimmicks in the file \type {supp-fun}. So enjoy yourself.

\section {Symbols and glyphs}

Some day you may want to define your own symbols, if
possible in such a way that they nicely adapt themselves to
changes in style and size. A good example are the \symbol
[euro] symbols. You can take a look in \type {symb-eur.tex}
to see how such a glyph is defined.

\starttyping
\definefontsynonym [EuroSerif]     [eurose]
\definefontsynonym [EuroSerifBold] [euroseb]
...
\definefontsynonym [EuroSans]      [eurosa]
\definefontsynonym [EuroSansBold]  [eurosab]
...
\definefontsynonym [EuroMono]      [euromo]
\definefontsynonym [EuroMonoBold]  [euromob]
\stoptyping

Here we use the free Adobe euro fonts, but there are
alternatives available. The symbol itself is defined as:

\starttyping
\definesymbol [euro] [\getglyph{Euro}{\char160}]
\stoptyping

You may notice that we only use the first part of the
symbolic name. \CONTEXT\ will complete this name according
to the current style. You can now access this symbol with
\typ {\symbol [euro]}

\starttabulate[|l|c|c|c|c|c|c|]
\NC           \NC \tex{tf}    \NC \tex{bf}    \NC \tex{sl}
              \NC \tex{it}    \NC \tex{bs}    \NC \tex{bi}    \NC\NR
\NC \rm Serif \NC \rm\tf\euro \NC \rm\bf\euro \NC \rm\sl\euro
              \NC \rm\it\euro \NC \rm\bs\euro \NC \rm\bi\euro \NC\NR
\NC \ss Sans  \NC \ss\tf\euro \NC \ss\bf\euro \NC \ss\sl\euro
              \NC \ss\it\euro \NC \ss\bs\euro \NC \ss\bi\euro \NC\NR
\NC \tt Mono  \NC \tt\tf\euro \NC \tt\bf\euro \NC \tt\sl\euro
              \NC \tt\it\euro \NC \tt\bs\euro \NC \tt\bi\euro \NC\NR
\stoptabulate

More details on defining symbols and symbol sets can be
found in the reference manual and documentation of the
symbol modules.

\section{Encodings}

Until now we assumed that an~\type {a} will become an~a
during type setting. However, this is not always the case.
Take for example~\"a or~\ae. This character is not available
in every font and certainly not in the Computer Modern
Typefaces. Often a combination of characters \type {\"a} or a
command \type {\ae} will be used to produce such a character.
In some situation \TEX\ will combine characters
automatically, like in \type {fl} that is combined to fl and
not \hbox{f}\hbox{l}. Another problem occurs in converting
small print to capital print and vice versa.

Below you see an example of the \type {texnansi} mapping:


\startbuffer[enco-1]
\startmapping[texnansi]
  \definecasemap 228 228 196  \definecasemap 196 228 196
  \definecasemap 235 235 203  \definecasemap 203 235 203
  \definecasemap 239 239 207  \definecasemap 207 239 207
  \definecasemap 246 246 214  \definecasemap 214 246 214
  \definecasemap 252 252 220  \definecasemap 220 252 220
  \definecasemap 255 255 159  \definecasemap 159 255 159
\stopmapping
\stopbuffer

\typebuffer[enco-1]

This means so much as: in case of a capital the character
with code 228 becomes character 228 and in case of small
print the character becomes character 196.

These definitions can be found in \type {enco-ans}. In this
file we can also see:


\startbuffer[enco-2]
\startencoding[texnansi]
  \defineaccent " a 228
  \defineaccent " e 235
  \defineaccent " i 239
  \defineaccent " o 246
  \defineaccent " u 252
  \defineaccent " y 255
\stopencoding
\stopbuffer

\startbuffer[enco-3]
\startencoding[texnansi]
  \definecharacter ae 230
  \definecharacter oe 156
  \definecharacter o  248
  \definecharacter AE 198
\stopencoding
\stopbuffer

\typebuffer[enco-2]

and

\typebuffer[enco-3]

As a result of the way accents are placed over characters we
have to approach accented characters different from normal
characters. There are two methods: \TEX\ does the accenting
itself {\em or} prebuild accentd glyphs are used. The
definitions above take care of both methods. Other
definitions are sometimes needed. In the documentation of
the file \type {enco-ini} more information on this can be
found.

\section{Map files}

If you're already sick of reading about fonts, you probably
don't want read this section. But alas, \DVI\ post processors
and \PDFTEX\ will not work well if you don't provide them
\type {map} files that tell them how to handle the files
that contain the glyphs.

In its simplest form, a definition looks as follows:

\starttyping
usedname < texnansi.enc < realname.pfb
\stoptyping

This means as much as: when you want to include a file that
has the \type {tfm} file \type {usedname}, take the outline
file \type {realname.pfb} and embed it with the \type
{texnansi} encoding vector. Sometimes you need more
complicated directives and you can leave that to the
experts. We try to keep up with changes in the map file
syntax, the names of fonts, encodings, locations in the
\TEX\ tree, etc. However, it remains a troublesome area.

It makes sense to take a look at the \type {cont-sys.rme} file
to see what preferences make sense. If you want to speed up
the typescript processing, say (in \type {cont-sys.tex}:

\starttyping
\preloadtypescripts
\stoptyping

If you want to change the default encoding, you should add
something:

\starttyping
\setupencoding [default=texnansi]
\stoptyping

If you want the default berry names:

\starttyping
\usetypescript [berry] [\defaultencoding]
\stoptyping

If you run into missing font metrics kind of problems,
you may want to add:

\starttyping
\usetypescript[adobekb] [\defaultencoding]
\stoptyping

Beware: if you use an other encoding afterwards, change this
into:

\starttyping
\usetypescript[berry]   [all]
\usetypescript[adobekb] [all]
\stoptyping

You can let \CONTEXT\ load the map files for \PDFTEX:

\starttyping
\autoloadmapfilestrue
\stoptyping

The following lines will remove exiting references to map
files and load a few defaults.

\starttyping
\resetmapfiles
\loadmapfile[original-base.map]
\loadmapfile[original-ams-base.map]
\loadmapfile[original-public-lm.map]
\stoptyping

As said, map files are a delicate matter.

\section{Installing fonts}

Most \TEX\ distributions come with a couple of fonts, most
noticeably the Computer Modern Roman typefaces. In order to
use a font, \TEX\ has to know its characteristics. These are
defined in \type {tfm} and \type {vf} files. In addition to
these files, on your system you can find a couple of more
file types.

\starttabulate[|cT|lp|]
\HL
\NC \bf suffix \NC \bf content \NC \NR
\HL
\NC tfm \NC \TEX\ specific font metric files that, in
            many cases, can be generated from \type {afm}
            files \NC \NR
\NC vf  \NC virtual font files, used for building glyph
            collections from other ones \NC \NR
\NC afm \NC Adobe font metric files that are more limited
            than \type {tfm} files (especially for math
            fonts) \NC \NR
\NC pfm \NC Windows specific font metric files, not used
            by \TEX\ applications \NC \NR
\NC pfb \NC files that contain the outline specification of
            the glyphs fonts, also called Type 1 \NC \NR
\NC enc \NC files with encoding vector specifications \NC \NR
\NC map \NC files that specify how and what font files
            are to be included \NC \NR
\HL
\stoptabulate

On your disk (or cdrom) these files are organized in such a
way that they can be located fast. \footnote {If you have
installed \TETEX\ or \FPTEX\ (possibly from the \TEX live
\CDROM) you will have many thousands of font files on your
system.} The directory structure normally is as follows:

\starttyping
texmf / fonts  / tfm    / vendor   / name / *.tfm
               / afm    / vendor   / name / *.afm
               / pfm    / vendor   / name / *.pfm
               / vf     / vendor   / name / *.vf
               / type1  / vendor   / name / *.pfb
      / pdftex / config /                   *.cfg
               / config /                   *.map
               / config / encoding /        *.enc
\stoptyping

The \type {texmf-local} or even better \type {texmf-fonts}
tree normally contains your own fonts, so that you don't
have to reinstall them when you reinstall the main tree.
The \type {pdftex} directory contains the files that
\PDFTEX\ needs in order to make decisions about the fonts
to include. The \type {enc} files are often part of
distributions, as is the configuration \type {cfg} file.
When you install new fonts, you often also have to add or
edit \type {map} files.

\CONTEXT\ comes with a \PERL\ script \type {texfont.pl}
that you can use to install new fonts. Since its usage is
covered by a separate manual, we limit ourselves to a short
overview.

Say that you have just bought a new font. A close look at
the files will reveal that you got at least a bunch of \type
{afm} and \type {pfb} files and if you're lucky \type {tfm}
files.

Installing such a font can be handled by this script. For
this you need to know (or invent) the name of the font
vendor, as well as the name of the font. The full set of
command line switches is given below: \footnote {there are a
couple of more switches described in the manual \type
{mtexfonts}.}

\starttabulate[|lT|lp|]
\HL
\NC \bf switch \NC \bf meaning \NC \NR
\HL
\NC fontroot   \NC texmf font root (automatically determined) \NC \NR
\NC vendor     \NC vendor name (first level directory) \NC \NR
\NC collection \NC font collection (second level directory)\NC \NR
\NC encoding   \NC encoding vector (default: texnansi) \NC \NR
\NC sourcepath \NC when installing, copy from this path \NC \NR
\NC install    \NC copy files from source to font tree \NC \NR
\NC makepath   \NC when needed, create the paths \NC \NR
\NC show       \NC run tex on \type{*.tex} afterwards \NC \NR
\HL
\stoptabulate

You seldom need to use them all. In any case it helps if you
have a local path defined already. The next sequence does
the trick:

\starttyping
texfont --ve=FontFun --co=FirstFont --en=texnansi --ma --in
\stoptyping

This will generate the \type {tfm} files from the \type
{afm} files, and copy them to the right place. The Type~1
files (\type {pfb}) will be copied too. The script also
generates a \type {map} file. When this is done successfully,
a \TEX\ file is generated and processed that shows the font
maps. If this file looks right, you can start using the
fonts. The \TEX\ file also show you how to define the fonts.

This script can also do a couple of more advanced tricks.
Let us assume that we have bought (or downloaded) a new
font package in the files \type {demofont.afm} and \type
{demofont.pfb} which are available on the current (probably
scratch) directory. First we make sure that this font is
installed (in our case we use a copy of the public Iwona
Regular):

\starttyping
texfont --ve=test --co=test --ma --in demofont
\stoptyping

We can now say:

% \loadmapfile[demofont.map] % in case we forgot to generate

\startbuffer
\loadmapfile[texnansi-test-test.map]
\definefontsynonym[DemoFont][texnansi-demofont]
\ruledhbox{\definedfont[DemoFont at 50pt]Interesting}
\stopbuffer

\typebuffer \startlinecorrection \getbuffer \stoplinecorrection

From this font, we can derive a slanted alternative by
saying:

\starttyping
texfont --ve=test --co=test --ma --in --sla=.167 demofont
\stoptyping

The map file is automatically extended with the entry needed.

\startbuffer
\definefontsynonym[DemoFont-Slanted][texnansi-demofont-slanted-167]
\ruledhbox{\definedfont[DemoFont-Slanted at 50pt]Interesting}
\stopbuffer

\typebuffer \startlinecorrection \getbuffer \stoplinecorrection

We can also create a wider version:

\starttyping
texfont --ve=test --co=test --ma --in --ext=1.50 demofont
\stoptyping

When you use the \type {--make} and \type {--install} switch,
the directories are made, fonts installed, and entries
appended to the map file if needed.

\startbuffer
\definefontsynonym[DemoFont-Extended][texnansi-demofont-extended-1500]
\ruledhbox{\definedfont[DemoFont-Extended at 50pt]Interesting}
\stopbuffer

\typebuffer \startlinecorrection \getbuffer \stoplinecorrection

Instead of using pseudo caps in \TEX\ by using \type
{\kap}, you can also create a pseudo small caps font.

\starttyping
texfont --ve=test --co=test --ma --in --cap=0.75 demofont
\stoptyping

This method is much more robust but at the cost of an extra
font.

\startbuffer
\definefontsynonym[DemoFont-Caps][texnansi-demofont-capitalized-750]
\ruledhbox{\definedfont[DemoFont-Caps at 50pt]Interesting}
\stopbuffer

\typebuffer \startlinecorrection \getbuffer \stoplinecorrection

\starttabulate[|lT|lp|]
\HL
\NC \bf switch \NC \bf meaning \NC \NR
\HL
\NC extend=factor \NC stretch the font to the given factor \NC \NR
\NC narrow=factor \NC shrink the font to the given factor \NC \NR
\NC slant=factor  \NC create a slanted font \NC \NR
\NC caps=factor   \NC replace lowercase characters by small uppercase ones \NC \NR
\NC test          \NC use test/test as vendor/collection \NC \NR
\HL
\stoptabulate

When manipulating a font this way, you need to provide a
file name. Instead of a factor you can give the keyword
\type {default} or a \type {*}.

\starttyping
texfont --test --auto --caps=default demofont
\stoptyping

The previous example runs create fonts with the rather
verbose names:

\starttyping
demofont
demofont-slanted-167
demofont-extended-150
demofont-capitalized-750
\stoptyping

This naming scheme makes it possible to use more instances
without the risk of conflicts.

In the distribution you will find an example batch file
\type {type-tmf.dat} which creates metrics for some free
fonts for the encoding specified. When you create the
default font metrics this way, preferably \type
{texmf-fonts}, you have a minimal font system tuned for you
prefered encoding without the risk for name clashes. When
you also supply \type {--install}, the font outlines will be
copied from the main tree to the fonts tree, which sometimes
is handy from the perspective of consistency.

\section {Getting started}

This is the most tricky section to write, since fonts are
probably the most complicated aspect of \TEX. If you are not
sure that you have the latest \CONTEXT, fetch the zipped
archive \type {cont-tmf.zip} from the main site or one of
the mirrors. Unzip the archive in the path \type {texmf-local}
(or similar):

\starttyping
unzip cont-tmf.zip
\stoptyping

Run \type {mktexlsr} afterwards. In order to prevent
unwanted interference, you may want to remove old copies
of \CONTEXT. Removing the \type {base} paths is enough.

Next, take a look at \type {cont-sys.rme} for options that
you can set. You need to copy this file into one with the
suffix \type {tex} and put it in the \CONTEXT\ user path. If
you already have such a file, make sure that you bring it up
to date. Choose a default encoding and preload the map files
that \PDFTEX\ needs. If you want to use the default
filenames, load the \type {berry} typescript too, but if you
are going to install your own fonts, you may use the more
verbose naming scheme (which is what we do at \PRAGMA).

Again, make sure that you run \type {mktexlsr} after each
file that you add to the system.

We already discussed \type {texfont} and if you have a
couple of megabytes left, you can now generate font
metrics. If you want to isolate your fonts from the main
trees, which is a good idea if you also want to install your
own fonts.

The way \TEX\ searches for files (we're talking \WEBC\ now)
is determined by the configuration file to which the \type
{TEXMFCNF} environment variable points (the following
examples are from my own system):

\starttyping
set TEXMFCNF=T:/TEXMF/WEB2C
\stoptyping

When searching for files, a list of directories is used:

\starttyping
set TEXMF={$TEXMFFONTS,$TEXMFPROJECT,$TEXMFLOCAL,!!$TEXMFMAIN}
\stoptyping

Here we've added a font path, which itself is set with:

\starttyping
set TEXMFMAIN=E:/TEX/TEXMF
set TEXMFLOCAL=E:/TEX/TEXMF-LOCAL
set TEXMFFONTS=E:/TEX/TEXMF-FONTS
\stoptyping

Now you can generate metrics and map files. The batch file is
searched for at the \CONTEXT\ data path in the \TEXMF\ tree
or on the local path.

\starttyping
texfont --encoding=ec --batch type-tmf.dat
\stoptyping

If you want to play with encoding, you can also generate
more encodings, like \type {8r} or \type {texnansi}.

\starttyping
texfont --encoding=texnansi --batch type-tmf.dat
texfont --encoding=8r       --batch type-tmf.dat
\stoptyping

After a while, there will be generated \type {tfm}, \type
{vf}, and \type {map} files. If you let \CONTEXT\ pass
the map file directives to \PDFTEX, you're ready now.
Otherwise you need to add the names of the mapfiles to the
file \type {pdftex.cfg}. You can best add them in front of
the list, and, if you use \CONTEXT\ exclusively, you can
best remove the other ones.

As a test you can process the \TEX\ files that are generated
in the process. These also give you an idea of how well the
encoding vectors match your expectations.

Now, the worst that can happen to you when you process your
files, is that you get messages concerning unknown \type
{tfm} files or reports on missing fonts when \PDFTEX\
writes the file. In that case, make sure that you indeed
{\em have} the right fonts (generated) and|/|or that the map
files are loaded. As a last resort you can load all map
files by saying:

\starttyping
\usetypescript [map] [all]
\stoptyping

and take a look at the log file and see what is reported.

In due time we will provide font generation scripts for
installation of other fonts as well as extend the
typescript collection.

\section {Remarks}

It really makes sense to take a look at the font and type
definition files (\type {font-*.tex} and \type {type-*.tex}).
There are fallbacks defined, as well as generic definitions.
Studying styles and manual source code may also teach you a
few tricks.

\stopcomponent

\startcomponent co-typography

\environment contextref-env
\product contextref

\def\definition#1{{\it #1}}

\def\FakeLine#1%
  {\hbox to \hsize
     {\strut
      \hbox to \hsize
        {\startcolor[AltColor]%
         \leaders
         \hrule height .8\ht\strutbox depth  .6\dp\strutbox
         \hfil
         \stopcolor
         #1}%
      \hskip-\hsize
      \hbox to \hsize
        {\startcolor[white]%
         \leaders
         \hrule height .25pt depth .25pt
         \hfil
         \stopcolor
         \hphantom{#1}}%
      \hss}%
   \par}

\def\FakeParagraph#1#2%
 {\startlinecorrection[blank]
  \FakeLine{}\FakeLine{#1{#2{-}}}
  \FakeLine{}\FakeLine{#1{#2{,}}}
  \FakeLine{}\FakeLine{#1{#2{.}}}
  \stoplinecorrection}

% this chapter needs lots of typescripts

\usetypescript[map,sans,mono,handwriting,calligraphy,serif]
              [helvetica,schoolbook,times,antykwa-torunska,modern]


\chapter[typography]{Typography}

\section{Introduction}
\index{typography}

Throughout the millennia humans have developed and adapted methods for
storing facts and thoughts on a variety of different mediums. A very
efficient way of doing this is using logograms, like Chinese have done
for ages. Another method is to represent each syllable in a word by a
symbol, like the Japanese do when writing telegrams. However, the most
common way of storing characters is by using a limited set of shapes
representing basic sounds (a.k.a. phonemes). Such a collection is
called an \definition{alphabet}, and the shapes are called
\definition{letters}.

\TEX\ is primarily meant for typesetting languages that 
use this third method. The other two methods can also be dealt
with, but some extra effort is needed. In this chapter we will focus
on languages that use alphabets, the other methods will be
explained in later chapters.

The shapes representing the characters that make up an alphabet are
more or less standardized, and thereby can be recognized by readers
even if their details differ.  A collection of pictures matching
character shapes is called a \definition{font}, and the pictures in a
font are called \definition{glyphs}.

\startlinecorrection
\ruledhbox to \hsize
  {\hss
   \definefont[test][ComputerModern          at 60pt]\test gap\setstrut\strut\hss
   \definefont[test][Helvetica               at 60pt]\test gap\hss
   \definefont[test][Times-Roman             at 60pt]\test gap\hss
   \definefont[test][AntykwaTorunska-Regular at 60pt]\test gap\hss}
\stoplinecorrection

From left to right you see a Computer Modern font, a Helvetica lookalike, a
Times Roman lookalike and the Antiqua Torunska font, all scaled to 60pt.
As you can see, quite some variation is possible and when intermixed,
the result is not always pleasing to look at. The term \definition{fonts collection}
refers to a set of fonts combined together in such a way that the
overall appearance on a page looks good and reading is as comfortable
as possible.

\startlinecorrection
\ruledhbox to \hsize
  {\hss
   \definefont[test][Schoolbook-Roman      at 48pt]\test lap\setstrut\strut\hss
   \definefont[test][Schoolbook-Bold       at 48pt]\test lap\hss
   \definefont[test][Schoolbook-Italic     at 48pt]\test lap\hss
   \definefont[test][Schoolbook-BoldItalic at 48pt]\test lap\hss}
\stoplinecorrection

Even within a single font design there can be variations. In the
example above there are a light, a bold, an italic, and a bold italic
\definition{alternative} of a single font. Such a set of fonts with 
the same basic design is known as a \definition{font family}.

The distance between the individual glyphs in a word and the actual
glyphs that are used depends on the combinations of these glyphs.  In
the top line of the next sample, the gap between the~b and the~o as
well as the distance between the~o and the~x is slightly altered.
This is called kerning. Further, the separate glyphs for the~f and
the~i have been combined into a single one. This is called ligaturing.

\startlinecorrection
\hbox to \hsize{\hss\vbox
  {\forgetall \hsize=5cm
   \vfill
   \definefont[test][ComputerModern at 48pt]\test
   \hbox{box}
   \vskip-36pt
   \def\\#1%
     {\toprulefalse
      \bottomrulefalse
      \ruledhbox{\vrule width 0pt height 72pt#1}}
   \hbox{\\b\\o\\x}}
\kern 2cm
\vbox
  {\forgetall  \hsize=5cm
   \vfill
   \definefont[test][ComputerModern at 48pt]\test
   \hbox{file}
   \vskip-36pt
   \def\\#1%
     {%\toprulefalse
      %\bottomrulefalse
      \hbox{\vrule width 0pt height 72pt#1}}
   \hbox{\\f\\i\\l\\e}}
\hss}
\stoplinecorrection

The font shown here is Computer Modern, the default \TEX\ font. This
font is designed by Donald Knuth. The Computer Modern has many
kerning pairs, while the Palatino||like font that is used for most of
the text in this manual has only a few, while both have essentially
the same list of ligatures.


Micro||typography like kerning pairs and ligatures are not to be altered 
by the user, they are part of the font design and the required data is stored
inside the font file, together with the drawing routines for the
actual pictures. It {\em is\/} possible for the user to alter fonts
and interline spacing and some more aspects on the level of
macro||typography. The choice of font is the main topic of this
chapter.

There are many different methods that can be used to classify
fonts. There are classification systems based on the period in which
the style was first developed; on the characteristics of the font; or
the font application, like a newspaper or a book. Often, classification
systems mix these characteristics up to some point.

For example, the Computer Modern family can be classified as a
\quote{modern} font. This is a classication that primarily indicates
a period (late 18\high{th} century), but it also implies a particular
shape: \quote{modern} fonts have a high contrast between thick and
thin strokes, and their stress axis is perfectly vertical.

At the same time, specific fonts in the Computer Modern family can be
classified as \quote{serif} (glyphs strokes have embellishments at the
end), \quote{sans serif} (shapes end abruptly), or \quote{monospaced}
(all glyphs have the same width). 

The Computer Modern family is in fact inspired by one font in particular:
\quote{Modern 8a} by the Monotype corporation. Knuth implemented
Computer Modern in \METAFONT\ using parameters so that he could
generate a whole collection of fonts all closely matching eachother in
style. In \CONTEXT\ you will normally use a reimplementation of
Computer Modern using a more modern file format (Type~1 or OpenType).
This new version is called \quote{Latin Modern}, and also features an
extended glyph set making it usable for languages that could not be
typeset with Knuth's original fonts.

\startlinecorrection
\ruledhbox to \hsize
  {\hss
   \definefont[test][LMRoman-Regular           at 48pt]\test ok\setstrut\strut\hss
   \definefont[test][LMSans-Regular            at 48pt]\test ok\hss
   \definefont[test][LMTypewriter-Regular      at 48pt]\test ok\hss
   \definefont[test][LMRoman-CapsRegular       at 48pt]\test ok\hss
   \definefont[test][LMTypewriterVarWd-Regular at 48pt]\test ok\hss}
\stoplinecorrection

In this example you see five font styles of Latin Modern: the Roman,
Sans, Typewriter, Smallcaps and Variable Typewriter. Computer Modern
is one of the few font families that comes with dedicated design
sizes.  The example below shows the differences of a 5, 7, 9, 12 and
17~point design scaled up to 48 points. Such nuances in font size are
seldom seen these days.

\startlinecorrection
\ruledhbox to \hsize
  {\hss
   \definefont[test][cmr5  at 48pt]\test ok\setstrut\strut\hss
   \definefont[test][cmr7  at 48pt]\test ok\hss
   \definefont[test][cmr9  at 48pt]\test ok\hss
   \definefont[test][cmr12 at 48pt]\test ok\hss
   \definefont[test][cmr17 at 48pt]\test ok\hss}
\stoplinecorrection

As explained earlier, the general appearance of a font style can be
classified according to many schemes. 
In \in {table} [tab:font triplets] you can see some examples of the naming
of font styles that are often found together in a single document.

\startbuffer[styles]

\vskip1ex
\startcombination[3*3]
  {\rmtfc\setupinterlinespace    Serif\strut \end} {}
  {\sstfc\setupinterlinespace     Sans\strut \end} {}
  {\tttfc\setupinterlinespace     Mono\strut \end} {}
  {\rmtfc\setupinterlinespace  Regular\strut \end} {}
  {\sstfc\setupinterlinespace  Support\strut \end} {}
  {\tttfc\setupinterlinespace TeleType\strut \end} {}
  {\rmtfc\setupinterlinespace    Roman\strut \end} {}
  {\sstfc\setupinterlinespace     Sans\strut \end} {}
  {\tttfc\setupinterlinespace     Type\strut \end} {}
\stopcombination
\vskip1ex

\stopbuffer

\placetable
  [here][tab:font triplets]
  {Some ways of classifying the styles in a font.}
  {\getbuffer[styles]}

The top two series are normally used by typographers, the bottom
series is what was traditionally used in plain \TEX. In \CONTEXT\ all
three series of terms can be used because they are remapped to the
same set of internal commands. As will be explained later, the command \type {\rm}
is used to switch to a roman|/|serif|/|regular style, and \type {\tt}
for switching to mono spaced or typewriter style, etcetera.

Text can be typeset in different font sizes. The unit \type {pt} is
often used to specify the size. The availability of these font sizes
are defined in definition files.  Traditionally font designers used to
design a glyph collection for each font size, but nowadays most fonts
have a single design size of 10 points, or small set of sizes with
names indicating their proposed use, like {\em caption}, {\em text},
and {\em display}.

The next sections will go into the details of switching of font styles and
fonts in your documents. Be warned that the font switching mechanism
is rather complex. This is caused by the different modes like math
mode and text mode in \CONTEXT. If you want to be understand the
mechanism fully, you will have to acquaint yourself with the concept
of encoding vectors and obtain some knowledge on fonts and their
peculiarities.

\section[bodyfont]{The mechanism}
\index{roman}
\index{sans serif}
\index{typewriter}

Font switching is one of the eldest features of \CONTEXT\ because font
switching is indispensable in a macro package.  During the years
extensions to the font switching mechanism were inevitable. The
following starting points have been chosesn during the development of this
mechanism:

\startitemize[packed]
\item To change a {\em style} must be easy, this
      means switching to: roman (serif, regular), sans serif
      (support), teletype (monospaced) etc. (\type {\rm},
      \type {\ss}, \type {\tt} etc.)
\item More than one {\em alternative} set of glyphs shapes must be
      available like slanted and bold (\type {\sl} and \type {\bf}).
\item Different font {\em families} like Latin Modern Roman 
      and Lucida Bright must be supported.
\item It must be possbile to combine different families into font
      {\em collections}.
\item Different sub|| and superscripts must be
      available. These script sizes have to be retained across the
      switching of family, style and alternative.
\item It should be possible to combine all of these requirements
      into a single definition unit called a {\em body font}.
\item Changing the global font collection as well as the size must 
      also be easy, and so sizes between 8pt and 14.4pt must be
      available by default.
\stopitemize

Before reading further, please stop for a moment to make sure you
thoroughly comprehend the above paragraphs. \CONTEXT's terminology
probably differs from what you are accustomed to, especially if you
were previously a \LATEX\ user.

\section[font switching]{Font switching}
\index{fonts}
\index{roman}
\index{slanted}
\index{boldface}
\index{italic}
\index{typewriter}
\index{sans serif}
\index{old style}
\index{medaeval numbers}

The mechanism to switch from one style to another is somewhat complex,
not in the least because the terminology is a bit fuzzy.  A quick
recap: we call a collection of fonts, like Lucida or Computer Modern
Roman, a {\em family}.  Within such a family, the members can be
grouped according to characteristics. Such a group is called a {\em
style}. Examples of styles within a family are: \quote{roman},
\quote{sans serif} and \quote{teletype}. We saw already that there can
be alternative classifications, but they all refer to the presence of
serifs and the glyphs having equal widths. Within a style there
can be {\em alternatives}, like \quote{boldface} and \quote{slanted}.

There are different ways to change into a new a style or
alternative. You can use \type {\ss} to switch to a sans
serif font style and \type {\bf} to get a bold alternative.
When a different style is chosen, the alternatives adapt
themselves to this style. Often a document will be typeset 
using just one combination of family and style. 
This is called the bodyfont.

Consistent use of commands like \type {\bf} and \type
{\sl} in the text will automatically result in the desired
bold and slanted altermatives when you change the family or
style in the setup area of your input file. 

\subsection[font style switching]{Font style switching}

Switching to another font style is done by one of five 
two-letter commands that are listed in~\in{table}[tab:style switches].

\startbuffer[styleswitch]
\vskip 1ex
\starttabulate[|l|l|]
%\NC \bf style  \NC \bf Long names and aliases    \NC\NR
\NC \type{\rm} \NC serif, regular, roman, rm     \NC\NR
\NC \type{\ss} \NC sans, support, sansserif, ss  \NC\NR
\NC \type{\tt} \NC mono, type, teletype, tt      \NC\NR
\NC \type{\hw} \NC handwritten, hw               \NC\NR
\NC \type{\cg} \NC calligraphic, cg              \NC\NR
\NC --         \NC mm                            \NC\NR
\stoptabulate
\vskip 1ex
\stopbuffer

\placetable
  [here]
  [tab:style switches]
  {Font style switching commands}
{\getbuffer[styleswitch]}

The \quote{handwritten} and \quote{calligraphic} font styles are
sometimes useful when dealing with very elaborate document layout
definitions. In the \CONTEXT\ distribution, only the Lucida font
family uses these styles, in any other font set they are simply
ignored. You could use them in your own font setups if you so desire
(see the next chapter for font setup definitions).

There is a sixth internal style that is only ever referenced as
\quote{mm}. This style handles math fonts. It does not make sense to
use this style directly so there is no command attached to it, but it
is quite important internally so it makes sense to introduce it right
away.

\subsection[font alternative switching]{Font alternative switching}

The alternatives within a style are given in~\in{table}[tab:alternative switches]. 
Not all fonts have both italic and slanted or the bold alternatives of
each. Some other fonts do not have small caps or only one set of
digits.  When an alternative is not known, \CONTEXT\ will attempt to
choose a suitable replacement automatically. For instance, the italic
alternative may be used for if slanted is not available or vice versa.


\startbuffer[alternativeswitch]
\vskip 1ex
\starttabulate[|l|l|]
\NC \type{\bf} \NC bold                                \NC\NR
\NC \type{\sl} \NC slanted                             \NC\NR
\NC \type{\it} \NC italic                              \NC\NR
\NC \type{\bs} \NC boldslanted, slantedbold            \NC\NR
\NC \type{\bi} \NC bolditalic, italicbold              \NC\NR
\NC \type{\sc} \NC smallcaps                           \NC\NR
\NC \type{\os} \NC mediaeval (from {\em oldstyle}) \NC\NR
\NC \type{\tf} \NC normal (from {\em typeface})    \NC\NR
\stoptabulate
\vskip 1ex
\stopbuffer

\placetable
  [here]
  [tab:alternative switches]
  {Font alternative switching commands and their keyword equivalents.
   With \type {\os} you tell \CONTEXT\ that you prefer mediaeval or
   old||style numbers as in {\os 139} over~{\rm 139}.}
{\getbuffer[alternativeswitch]}

Besides these two-letter commands, there is a series of font selector
commands with a suffix attached. Some examples of that are:

\startexample
\starttyping
\tfx \bfx \slx \itx
\tfa \tfb \tfc \tfd \tfxx
\stoptyping
\stopexample

Each of the ordered alphabetic suffixes \type{a}, \type{b}, \dots\
select a somewhat larger actual font than the previous one. The
\type{x} and \type{xx} suffixes select smaller and yet smaller 
versions.


\startbuffer[xalternativeswitch]
\vskip 1ex
\starttabulate[|l|l|]
\NC \type{\bfx} \NC smallbold                           \NC\NR
\NC \type{\slx} \NC smallslanted                        \NC\NR
\NC \type{\itx} \NC smallitalic                         \NC\NR
\NC \type{\bsx} \NC smallboldslanted, smallslantedbold  \NC\NR
\NC \type{\bix} \NC smallbolditalic, smallitalicbold    \NC\NR
\NC \type{\tfx} \NC small, smallnormal                  \NC\NR
\stoptabulate
\vskip 1ex
\stopbuffer

\placetable
  [here]
  [tab:small alternative switches]
  {Small alternative switching commands and their keyword equivalents.}
{\getbuffer[xalternativeswitch]}

Besides the \quote{small} switches that are mentioned 
in~\in{table}[tab:small alternative switches],
it depends on the completeness of the font definition files whether
commands like \type {\ita}, \type {\bfxx}, \type {\bfc}, etc.
are available. For the core \CONTEXT\ fonts, you can count on at least
\type{\tfa}, \type{\tfb}, \type{\tfc}, \type{\tfd}, and \type{\tfxx} 
being defined. For the others, just try and see what happens.

When you have chosen a larger charactersize,
for example \type {\tfb}, then \type {\tf} equals \type {\tfb},
\type {\bf} equals \type {\bfb}, etc. This method is almost always
preferable over returning to the original character size, but it 
may catch you off-guard.

More generic font scaling commands are also available:

\startexample
\starttyping
\tx \txx
\setsmallbodyfont \setbigbodyfont
\stoptyping
\stopexample

The command \type {\tx} adapts itself to both the style and the
alternative. This command is rather handy when one wants to write
macros that act like a chameleon. Going one more step smaller, is
possible too: \type {\txx}. Using \type {\tx} when \type {\tx} is
already given, is equivalent to \type {\txx}.

The commands \type{\setsmallbodyfont} and \type{\setbigbodyfont} switch 
to the \quote{small} and \quote{big} body font sizes. These relative 
sizes are defined via the \quote{body font environment}, 
see~\in{section}[sec:body font environment]. 

The various commands will adapt themselves to the actual
setup of font and size. For example:

\startbuffer
{\rm test {\sl test} {\bf test} \tfc test {\tx test} {\bf test}}
{\ss test {\sl test \tx test} {\bf test \tx test}}
\stopbuffer

\startexample
\typebuffer
\stopexample

will result in:

\startreality
\startlines
\getbuffer
\stoplines
\stopreality

When the \type {\rm} style is active, \CONTEXT\ will interpret the
command \type {\tfd} as if it was \type {\rmd}, when the style
\type{\ss} is active, \type {\tfd} as is treated as \type {\ssd}. 
All default font setups use \type {tf}||setups so they will
automatically adapt to the current font style.

The remainder of this paragraph is for completeness' sake  only.
Use of the following commands in new documents is discouraged.

Frequent font switching leads to longer processing times.
When no sub- or superscripts are used and you are very
certain what font you want to use, you can perform fast font
switches with: \type {\rmsl}, \type {\ssbf}, \type {\tttf},
etc.

The plain \TeX\ compatible font switches 
\type {\vi}, \type {\vii}, \type {\viii}, \type {\ix}, \type {\x}, and 
\type {\xii} are also defined, these have local effects 
like \type{\tfx} and \type{\tfa}. 

\subsection{Switching font styles in setup commands}

A number of \CONTEXT\ commands use the parameter \type {style} to set
the used font.  The parameter mechanism is rather flexible so that 
within the parameter \type {style} you can use any of the font switching 
commands like {\bf} or \type {bf} or \type{\switchtobodyfont}, 
but also a number of keywords like
\startexample
\starttyping
normal  bold  slanted  boldslanted  italic  bolditalic  type
small  smallbold  smallslanted  ...  smallitalic  ...  smalltype
capital
\stoptyping
\stopexample

Most of these keywords have alread been listed in the tables \in{}[tab:alternative switches]
and \in{} [tab:small alternative switches], but a few predefined ones are still missing. 
These are displayed in~\in{table}[tab:last alternative switches], together with the commands
they execute. As is normal in \CONTEXT, you can extend the list of accepted keywords by 
defining your own. This will be  explained in\in~{section}[sec:definealternativestyle] 
in the next chapter.

\startbuffer[lastalternativeswitch]
\vskip 1ex
\starttabulate[|l|l|]
\NC \type{\tt}               \NC type, mono      \NC\NR
\NC \type{\ttx}              \NC smalltype       \NC\NR
\NC \type{\ss}               \NC sans, sansserif \NC\NR
\NC \type{\ss\bf}            \NC sansbold        \NC\NR
\NC \type{\setsmallbodyfont} \NC smallbodyfont   \NC\NR
\NC \type{\setbigbodyfont}   \NC bigbodyfont     \NC\NR
\NC \type{\smallcapped}      \NC cap, capital    \NC\NR
\NC \type{\WORD}             \NC WORD            \NC\NR
\stoptabulate
\vskip 1ex
\stopbuffer

\placetable
  [here]
  [tab:last alternative switches]
  {Remaining font alternative keywords.}
{\getbuffer[lastalternativeswitch]}


\section[linespacing]{Line spacing}
\index{linespacing}
\index{baselines}
\index{whitespacing}
\index{spacing}
\macro{\tex{setupinterlinespace}}

In \TEX\ linespacing is determined by a number of variable
dimensions like \type {\topskip}, \type {\parskip} and \type
{\baselineskip}. However, in \CONTEXT\ these variables are
related to the bodyfont size.

A line has a height and a depth. The distance between two
lines is normally equal to the sum of the maximum height and
maximum depth:

\leavevmode
\blackrule[height=max,depth=0pt] +
\blackrule[height=0pt,depth=max] =
\blackrule[height=max,depth=max]

This sum is in \CONTEXT\ equal to 2.8ex, so almost three
times the height of an~x. This is about $1.2 \times$ the
bodyfont height. The proportion between maximum height and
depth is default .72~:~.28. Linespacing alters when a new
bodyfont is used or when linespacing is defined explicitly
by:

\starttyping
\bfd \setupinterlinespace Now, the interline spacing is larger ... \par
\stoptyping

One has to consider the fact that \TEX\ operates on
paragraphs and within a group one has to close the paragraph
explicitly with an empty line or \type {\par}. However, in
most cases \CONTEXT\ will take care of this.

Sometimes a line does not have the maximum height or depth.
The next example illustrates this:

\def\somecharacter#1%
  {\setbox0=\hbox{#1}%
   \blackrule[width=\wd0,height=\ht0,depth=\dp0]}

\def\someline%
  {\noindent \processtokens\somecharacter\somecharacter\relax\space
     {The height and depth of lines differs.}}

\someline

It says:

\startbaselinecorrection
\ruledhbox{The height and depth of lines differs.}
\stopbaselinecorrection

When we put two of these lines above each other we will get:

\someline \crlf \someline

You can see that the distance is somewhat bigger that the
sum of the height and depth of each separate line. This
distance is called the baseline distance (\type
{\baselineskip}) and is in this document \the \baselineskip.
If we add some extra height to the line we see this:

\someline \blackrule[height=2ex,depth=2ex] \crlf \someline

To prevent the lines from touching \TEX\ adds a \type
{\lineskip}, in our example {\the\lineskip}. In a similar
way \TEX\ is taking care of the first line of a page to have
at least a height of \type {\topskip} (here \the\topskip).

Linespacing is set up by:

\showsetup{setupinterlinespace}

Linespacing adapts to the size of the actual bodyfont
automatically. This means that the user can leave this
command untouched, unless a different linespacing is wanted.
Instead of a factor one of the predetermined values \type
{small} (1.0), \type {medium} (1.25) or \type {big} (1.5)
can be given. Below an example is given of a text with a
linespacing of 1.25: \type{\setupinterlinespace[medium]}.

\startreality
\startnarrower
\setupinterlinespace[1.25]
Whenever it comes to my mind that \quotation {everything that comes in
quantities, will somehow survive}, I also got the feeling that in a few
hundred years people will draw the saddening conclusion that all those
top||ten hits produced by computers represent the summum of todays
musical and instrumental abilities. Isn't it true that archeologists can
spend a lifetime on speculating about some old coins from the first century?
On the other hand, the mere fact that one can have success with this type
of non||music success of some top||hit musicians demonstrates both the
listeners inability to rate the product and the lack of self criticism of
the performers. In principle the future archeologist will therefore draw
the right conclusion. \par
\stopnarrower
\stopreality

When you make a fontswitch the linespacing is adapted when you give
the command \hbox{\type {\setupinterlinespace}} without any setup
parameters and also when you add the key \type {reset}, for example

\startexample
\starttyping
\setupinterlinespace[reset,medium]
\stoptyping
\stopexample

The text below is typeset in the fontsize \type {\tfa}, using
the following input:

\startexample
\starttyping
\start \tfa \setupinterlinespace 
In books meant for children we often find
a somewhat ... when needed. \par \stop
\stoptyping
\stopexample

In this example the \type {\par} is necessary because
otherwise \TEX\ will have forgotten the linespacing before
the paragraph is finished (in that case, the paragraph is
ended by the empty line after the \type {\stop}).


\start 
\startnarrower
\tfa \setupinterlinespace In books meant for children
we often find a somewhat bigger typeface, for instance
because we are convinced that this enables them to read the
book themselves. On the other hand, I can also imagine that
it is a cheap way to increase the number of pages.
Unfortunately scaling up will also uncover the lack of
quality of the typesetting used and|/|or the lack of
typographic knowledge of the user of such a system. The
interline space sometimes differs on a line by line basis,
and depends on the {\tfd height} of the current line.
Therefore, when changing the style, something that should
only be done on purpose, also change the baseline distance
when needed. \par 
\stopnarrower 
\stop

Instead of a keyword, one can pass a key||value pair to
define the characteristics of a line. 

\showsetup{setupinterlinespace2}

The default settings are:

\starttyping
\setupinterlinespace
  [height=.72,
   depth=.28,
   top=1.0,
   bottom=0.4,
   line=2.8ex]
\stoptyping

The \type {height} and \type {depth} determine the ratio
between the height and depth of a line. The baseline
distance is set to 2.8ex. The parameters \type {top} and
\type {bottom} specify the relation between the bodyfont
size and the height of the first line and the depth of the
last line on a page. The last two quantities are related to
\TEX's \type {\topskip} and \type {\maxdepth}.

We will see later that instead of setting the spacing at the document
level, i.e.\ for each font, you can set the spacing per body font
environment:

\starttyping
\setupbodyfontenvironment
  [modern] [12pt]
  [interlinespace=14pt]
\stoptyping


\section[emphasize]{Emphasize}
\index{emphasize}
\index{slanted}
\index{italic}
\macro{\tex{em}}

Within most macropackages the command \type {\em} is
available. This command behaves like a chameleon which means
that it will adapt to the actual typeface. In \CONTEXT\
\type {\em} has the following characteristics:

\startitemize[packed]
\item a switch to {\sl slanted} or {\it
      italic} is possible
\item a switch within \type {\bf} results in {\bs bold
      slanted} or {\bi bold italic} (when available)
\item a so called {\em italic correction} is performed
      automatically (\type {\/})
\stopitemize

The bold italic or bold slanted characters are supported only
when \type {\bs} and \type {\bi} are available.

\startbuffer
The mnemonic {\em em} means {\em emphasis}.
{\em The mnemonic {\em em} means {\em emphasis}.}
{\bf The mnemonic {\em em} means {\em emphasis}.}
{\em \bf The mnemonic {\em em} {\em emphasis}.}
{\it The mnemonic em {\em means \bf emphasis}.}
{\sl The mnemonic em {\em means \bf emphasis}.}
\stopbuffer

\startexample
\typebuffer
\stopexample

This results in:

\startlines
\getbuffer
\stoplines

The advantage of the use of \type {\em} over \type {\it}
and|/|or \type {\sl} is that consistent typesetting is
enforced.

By default emphasis is set at {\em slanted}, but in this text
it is set at {\em italic}. This setting is made via 
\type{\setupbodyfontenvironment}, 
see~\in{section}[sec:body font environment] for more details:

\startexample
\starttyping
\setupbodyfontenvironment
   [default]
   [em=italic]
\stoptyping
\stopexample

\section[capitals]{Capitals}
\index{capital characters}
\index{capitals}
\index{small capitals}
\index{small||caps}
\macro{\tex{setupcapitals}}
\macro{\tex{CAP}}
\macro{\tex{Cap}}
\macro{\tex{cap}}
\macro{\tex{smallcapped}}
\macro{\tex{nocap}}
\macro{\tex{Caps}}
\macro{\tex{Words}}
\macro{\tex{WORDS}}
\macro{\tex{Word}}
\macro{\tex{characters}}

Words and abbreviations can be typeset in capitals. Both
small and big characters are converted into capitals. When
\type {\cap} is used to typeset a capital the size is that
of an \type {\tx}. When you switch to slanted (\type {\sl}),
bold (\type {\bf}), etc. the capital letter will also
change. Since \type {\cap} has a specific meaning in math
mode, the formal implementation is called \type {\smallcapped}.
However in text mode one can use \type {\cap}.

\showsetup{cap}

\showsetup{Cap}

\showsetup{CAP}

\showsetup{Caps}

The first command converts all letters to a capital. You are
advised not to type capital letters in your source file
because real small caps distinguishes between small and big
letters.

\startbuffer
Capitals for \cap {UK} are \cap {OK} and capitals for \cap {USA} are
okay. But what about capitals in \cap {Y2K}.
\stopbuffer

\startexample
\typebuffer
\stopexample

this results in:

\startreality
\getbuffer
\stopreality

A \type {\cap} within a \type {\cap} will not lead to any
problems:

\startbuffer
\cap {People that have gathered their \cap {capital} at the cost of other
people are not seldom \nocap {decapitated} in revolutionary times.}
\stopbuffer

\startexample
\typebuffer
\stopexample

or:

\startreality
\getbuffer
\stopreality

In this example you can see that \type {\cap} can be temporarily
revoked by \type {\nocap}.

\showsetup{nocap}

The command \type {\Cap} changes the first character of a
word into a capital and \type {\CAP} changes letters that
are preceded by \type {\\} into capital letters. With \type
{\Caps} you can change the first character of several words
into a capital letter.

\showsetup{setupcapitals}

With this command the capital mechanism can be set up. The
key \type {sc=yes} switches to real {\sc Small Caps}. The key
\type {title} determines whether capitals in titles are changed.

Next to the former \type {\cap}||commands there are also:

\showsetup{Word}

and

\showsetup{Words}

These commands switch the first characters of a word or words into
capitals. All characters in a word are changed with:

\showsetup{WORD}

Let's end this section with real small capitals. When these are
available the real small caps \type {\sc} are preferred over
the pseudo||capital in abbreviations and logos.

\startbuffer
In a manual on \TeX\ and Con\TeX t there is always the question whether 
to type \cap{\TeX} and \cap{Con\TeX t} or {\sc \TeX} and {\sc Con\TeX t}. 
Both are defined as a logo in the style definition so we type \type {\TEX} 
and \type {\CONTEXT}, which come out as \TEX\ and \CONTEXT.
\stopbuffer

\startexample
\typebuffer
\stopexample

Results in:

\startreality
\getbuffer
\stopreality

{\sc It is always possible to typeset text in small
capitals. However, realize that lower case characters
discriminate more and make for an easier read.}

An important difference between \type {\cap} and \type {\sc}
is that the last command is used for a specific designed
font type. The command \type {\cap} on the other hand adapts
itself to the actual typeface: {\sl \cap {kap}}, {\bf \cap
{kap}}, {\bs \cap {kap}}, etc.

Some typesetting packages stretch words (inter character
spacing) to reach an acceptable alignment. In \CONTEXT\
this not supported. On purpose! Words in titles can be
stretched by:

\showsetup{stretched}

\startbuffer
\hbox to \hsize {\stretched{there\\is\\much\\stretch\\in ...}}
\hbox to 20em   {\stretched{... and\\here\\somewhat\\less}}
\stopbuffer

\startexample
\typebuffer
\stopexample

With \type {\\} you can enforce a space (\type {{}} is also
allowed).

\startreality
\leavevmode\getbuffer
\stopreality

These typographically non permitted actions are only allowed
in heads. The macros that take care of stretching do this
by processing the text character by character.


This chapter will not go into the details of underlining because
using underlining for typographical purposes is a bad practice.
Instead, the commands related to under- and overlining are discussed
in \in {section} [underline] (\over [underline]).


\section[bodyfontswitch]{Selecting bodyfonts}
\index{bodyfont}
\index{font size}
\macro{\tex{setupbodyfont}}
\macro{\tex{switchtobodyfont}}

The bodyfont (main font), font style and size is set up with:

\showsetup{setupbodyfont}

In a running text a temporary font switch is done with the
command:

\showsetup{switchtobodyfont}

This command doesn't change the bodyfont in headers and
footers. With \type {small} and \type {big} you switch to a
smaller or larger font.

In most cases, the command \type {\setupbodyfont} is only used once:
in the style definition, and font switching inside the document is
done with \type {\switchtobodyfont}. Don't confuse these two because
that may lead to some rather strange but legitimate effects. 

\subsection{Body font sizes}

Body font sizes actually consist of two components. Of course if you
specify a size it directly specifies the size at which the main font
is loaded, but a number of indirect parameters have to taken care of
as well. Think of things like the font size used in headers, footers,
footnotes, sub|| and superscripts, as well as the interline space and
a few others. 

This is why in \CONTEXT\ there is the concept of a {\em body font
environment} (expressed as a dimension), and that is what you pass as
an argument to \type{\setupbodyfont} or \type{\switchtobodyfont}. The
definitions as presented above use the indication \type{5pt ... 12pt}
for the body font environment, but actually any dimension is
acceptable. 

The most frequently used sizes are predefined as body font
environments: 4pt \dots\ 12pt, 14.4pt, and 17.3pt. But when you use a
different, not-yet-defined size specification |<|for example for a
titlepage|>| \CONTEXT\ will define a body font environment for that
size automatically.  While doing so, \CONTEXT\ normally works with a
precision of 1~decimal to prevent unnecessary loading of fontsizes
with only small size differences.

Be warned that in this case, the results may be a less than ideal. The
reason is that \CONTEXT\ not just has to load the actual font, but it
also has to guess at the various other settings like the relative font
sizes and the interline space.  It does so by using the values from
the nearest smaller body font environment is that is already defined.

You can extend the list of predefined body font environments and even
alter the precision in body font matching. See
the~\in{section}[sec:body font environment] for detailed information about how to
tweak or define your own body font sizes.

\blank

To end this section, the example below demonstrates how the interline
space is adapted automatically, when changing the size of the
bodyfont. Consider this input:

\startbuffer
{\switchtobodyfont[14.4pt] with these commands \par}
{\switchtobodyfont[12pt] for font switching  \par}
{\switchtobodyfont[10pt]  it is possible to   \par}
{\switchtobodyfont[8pt]  produce an eyetest: \par}
{\switchtobodyfont[6pt]  a x c e u i w m q p \par}
\stopbuffer

\startexample
\typebuffer
\stopexample

The actual \CONTEXT\ behaviour is shown below on the left. On the
right you can see what would have happened if the interline space
were not automatically adapted.

\startlinecorrection
\startcombination
  {\vtop{\forgetall\hsize.4\textwidth                \getbuffer}} {}
  {\vtop{\forgetall\hsize.4\textwidth\everybodyfont{}\getbuffer}} {}
\stopcombination
\stoplinecorrection

\subsection{Body font identifiers}

\macro{\tex{usetypescript}}

In the definition block of \type{setupbodyfont} there was a list of
words given besides the special marker \type{IDENTIFIER}. These words
are the symbolic \CONTEXT\ names for the font styles that we ran into
earlier, with a few aliases so that you do not have to worry about the
actual naming convention used. The symbolic names are mapped to
two-letter internal style abbreviations that are used internally,
see~\in{table}[tab:style switches] for an overview.

Although the macro syntax does not say so, you can use two-letter
internal style abbreviations (\type{ss}, \type{rm}) as well as the
longer names, if you prefer.

\blank 

We have seen already that there are other and easier ways to switch the
font style, so if \type{\setupbodyfont} could only be used for this
purpose it would not be all that useful. But luckily there is more:
the optional \type{IDENTIFIER} can be a \quote{body font name} (aka
\quote{typeface}). Such names have to be predefined, perhaps in a font
support file, or simply on earlier lines in the style definition.

A \quote{typeface} is a symbolic name that links a single font style
to actual font families. Such symbolic names are typically grouped
together in a definition block that sets up values that link the four
styles \type{\rm}, \type{\ss}, \type{\tt} and \type{\mm} to fonts in a
\quote{font collection}, and such definition blocks are called
\quote{typescripts}.

\CONTEXT\ expects you to define your own font setups, but there 
are quite a few examples predefined in various typescript files. Not
all of those are perpetually loaded, so you usually have to execute a
typescript explicitly to get the typeface names predefined. To this
end, typescripts {\em themselves\/} also have names. 

Executing a typescript is done by \type{\usetypescript}. We will get
back to \type{\usetypescript} later because it is in fact a very
flexible command, but let's discuss simple usage first.

\showsetup{usetypescript}

A typical input sequence for selecting the predefined \quote{palatino}
set of typefaces in \MKII\ will look like this:

\startexample
\starttyping
\usetypescript[palatino][ec]
\setupbodyfont[palatino,12pt]
\stoptyping
\stopexample

In this example the typescript named \type{palatino} is asked for in
the \type{ec} font encoding, and that defines a set of typefaces under
the name \type{palatino}. These are then used by \type{\setupbodyfont}
and eventually this makes \PDFTEX\ load the free Type~1 font URW Palladio
in the correct encoding.  URW Palladio is a font that looks a lot like the
commercial font Linotype Palatino by Hermann Zapf, which explains the
name of the typescript and typefaces.

Font encodings will be handled fully in the~\in{section}[sec:encodings]. 
For now, please take for granted the fact that \PDFTEX\ needs a second 
argument to \type{\usetypescript} that specifies an encoding name, and
that there is a fixed set of acceptable names that depends on the typescript
that is being requested.

In \XETEX\ and \MKIV\ the situation is a little bit different because
fonts are reencoded to match Unicode whenever that is possible. That
in turn means that \XETEX\ and \MKIV\ prefer to use OpenType fonts
over Type~1 fonts, so different typescript definitions are used behind
the scenes, and the second argument to \type{\usetypescript} becomes
optional. 

For example,

\startexample
\starttyping
\usetypescript[palatino]
\setupbodyfont[palatino,12pt]
\stoptyping
\stopexample

will make \XETEX\ and \LUATEX\ load the OpenType font Pagella. This is
a free font from the \TeX\ Gyre project, that also looks just like the
commercial font Linotype Palatino. You may as well leave the second
argument in place: while it will always be ignored by \LUATEX,
\XETEX\ will actually use that encoding if the typescript uses Type~1
fonts instead of the more modern OpenType or TrueType font formats. 

All predefined typescripts attach meaning to (at least) the three basic
text font styles, so you can e.g. do this:

\startexample
\starttyping
\usetypescript[times][ec]
\setupbodyfont[times,sans,12pt]
\stoptyping
\stopexample

and end up using the OpenType font \TeX\ Gyre Heros or the Type~1 font
URW Nimbus Sans~L. Both fonts are very similar in appearance to
Linotype Helvetica, by the way.

The typescripts that come with the \CONTEXT\ distribution are placed
in source files that have names that start with \type{type-}. Some of
these files are automatically loaded when needed, but most have to be loaded
explicitly. There is a list in~\in{table}[tab:typescript files]

\macro{\tex{preloadtypescripts}}

Some of the internal building blocks for typescripts are themselves located in
yet other files (font size and font map file information, for example).
Normally, when \CONTEXT\ has to load typescript information from files, it will
try to save memory by only executing the typescript it needs at that moment and
discarding all other information. If you have enough memory at your disposal, 
you can speed up typescript use considerably by adding 

\startexample
\starttyping
\preloadtypescripts
\stoptyping
\stopexample

in your preamble or your \type{cont-usr.tex}. This will make \CONTEXT\ store
all the typescript information in internal token registers the first (and
therefore only) time it loads the actual files.

\startbuffer[typefiles]
\begingroup
\switchtobodyfont[9pt]
\vskip 1ex
\starttabulate[|l|l|l|l|l|]
\NC \bf File   \NC \bf Loaded     \NC \bf Loaded    \NC \bf Loaded   \NC \bf Description \NC \NR
\NC            \NC \bf by \PDFTEX \NC \bf by \XETEX \NC \bf by \MKIV \NC                 \NC \FR
\NC type-akb   \NC no             \NC no            \NC no           \NC PostScript fonts using psnfss names (Type~1)\NC \NR
\NC type-buy   \NC no             \NC no            \NC no           \NC Various commercial fonts (Type~1)\NC \NR
\NC type-cbg   \NC no             \NC no            \NC no           \NC Greek free fonts (Type~1)\NC \NR
\NC type-cow   \NC no             \NC no            \NC no           \NC The \CONTEXT\ cow font (Type~1)\NC \NR
\NC type-exp   \NC no             \NC no            \NC no           \NC Commercial Zapf fonts (OpenType)\NC \NR
\NC type-fsf   \NC no             \NC no            \NC no           \NC Commercial Fontsite 500 fonts (Type~1)\NC \NR
\NC type-ghz   \NC no             \NC no            \NC no           \NC Commercial Zapf fonts (Type~1)\NC \NR
\NC type-gyr   \NC no             \NC no            \NC no           \NC The \TeX\ Gyre project fonts (Type~1)\NC \NR
\NC type-hgz   \NC no             \NC no            \NC no           \NC Commercial Zapf fonts (OpenType)\NC \NR
\NC type-msw   \NC no             \NC no            \NC no           \NC Fonts that come with Microsoft Windows (Type~1)\NC \NR
\NC type-omg   \NC no             \NC no            \NC no           \NC Omega free fonts (Type~1)\NC \NR
\NC type-one   \NC yes            \NC no            \NC no           \NC Various free fonts (Type~1)\NC \NR
\NC type-otf   \NC no             \NC yes           \NC yes          \NC Various free fonts (OpenType)\NC \NR
\NC type-xtx   \NC no             \NC yes           \NC no           \NC Fonts that come with MacOSX (OpenType)\NC \NR
\stoptabulate
\vskip 1ex
\endgroup
\stopbuffer

\placetable
  [here]
  [tab:typescript files]
  {The typescript source files that are part of \CONTEXT.}
  {\getbuffer[typefiles]}

Explicit loading one of those files is done via the macro \type{\usetypescriptfile}.
\macro{\tex{usetypescriptfile}}

\startbuffer[typescripts]
\begingroup
\switchtobodyfont[9pt]
\def\*#1{{\bf#1}}
\vskip 1ex
\starttabulate[|l|l|l|l|]
\NC \bf Typescript        \NC \bf Typeface      \NC \bf File           \NC \bf Encodings                     \NC \FR
\NC OmegaLGC              \NC omlgc             \NC type-omg           \NC (unspecified)                     \NC \NR
\NC antykwa-torunska      \NC antykwa           \NC type-one, type-otf \NC texnansi,ec,8r,t2a                \NC \NR
\NC cbgreek               \NC cbgreek           \NC type-cbg           \NC (unspecified)                     \NC \NR
\NC cbgreek-all           \NC cbgreek-all       \NC type-cbg           \NC (unspecified)                     \NC \NR
\NC cbgreek-medium        \NC cbgreek-medium    \NC type-cbg           \NC (unspecified)                     \NC \NR
\NC cow                   \NC cow               \NC type-cow           \NC default                           \NC \NR
\NC fourier               \NC fourier           \NC type-one           \NC ec                                \NC \NR
\NC iwona                 \NC iwona             \NC type-one, type-otf \NC texnansi,ec,8r,t2a                \NC \NR
\NC iwona-heavy           \NC iwona-heavy       \NC type-one, type-otf \NC texnansi,ec,8r,t2a                \NC \NR
\NC iwona-light           \NC iwona-light       \NC type-one, type-otf \NC texnansi,ec,8r,t2a                \NC \NR
\NC iwona-medium          \NC iwona-medium      \NC type-one, type-otf \NC texnansi,ec,8r,t2a                \NC \NR
\NC \*{lucida}            \NC lucida            \NC type-buy           \NC texnansi,ec,8r                    \NC \NR
\NC \*{lucidabfm}         \NC lucida            \NC type-buy           \NC texnansi,ec,8r                    \NC \NR
\NC \*{lucidabfm}         \NC lucidabfm         \NC type-buy           \NC texnansi,ec,8r                    \NC \NR
\NC \*{lucidaboldmath}    \NC lucida            \NC type-buy           \NC texnansi,ec,8r                    \NC \NR
\NC \*{lucidaboldmath}    \NC lucidaboldmath    \NC type-buy           \NC texnansi,ec,8r                    \NC \NR
\NC modern                \NC modern            \NC type-one, type-otf \NC texnansi,ec,qx,t5,default         \NC \NR
\NC modern-base           \NC modern            \NC type-one, type-otf \NC texnansi,ec,qx,t5,default,t2a/b/c \NC \NR
\NC modernvariable        \NC modernvariable    \NC type-one, type-otf \NC texnansi,ec,qx,8r,t5              \NC \NR
\NC \*{optima}            \NC optima            \NC type-one           \NC texnansi,ec,qx                    \NC \NR
\NC \*{optima}            \NC optima            \NC type-ghz           \NC texnansi,ec,qx                    \NC \NR
\NC \*{optima-nova}       \NC optima            \NC type-ghz, type-hgz \NC texnansi,ec                       \NC \NR
\NC \*{optima-nova-os}    \NC optima-os         \NC type-ghz, type-hgz \NC texnansi,ec                       \NC \NR
\NC \*{palatino}          \NC palatino          \NC type-hgz           \NC (cannot be used in \MKII)         \NC \NR
\NC \*{palatino}          \NC palatino          \NC type-one, type-otf \NC texnansi,ec,qx,8r,t5              \NC \NR
\NC \*{palatino-informal} \NC palatino-informal \NC type-hgz           \NC (cannot be used in \MKII)         \NC \NR
\NC \*{palatino-light}    \NC palatino-light    \NC type-exp           \NC (cannot be used in \MKII)         \NC \NR
\NC \*{palatino-medium}   \NC palatino-medium   \NC type-exp           \NC (cannot be used in \MKII)         \NC \NR
\NC \*{palatino-normal}   \NC palatino-normal   \NC type-exp           \NC (cannot be used in \MKII)         \NC \NR
\NC \*{palatino-nova}     \NC palatino          \NC type-hgz           \NC (cannot be used in \MKII)         \NC \NR
\NC \*{palatino-sans}     \NC palatino          \NC type-hgz           \NC (cannot be used in \MKII)         \NC \NR
\NC postscript            \NC postscript        \NC type-one, type-otf \NC texnansi,ec,qx,8r,t5              \NC \NR
\NC sheep                 \NC sheep             \NC type-cow           \NC default                           \NC \NR
\NC times                 \NC times             \NC type-one, type-otf \NC texnansi,ec,qx,8r,t5              \NC \NR
\stoptabulate
\vskip 1ex
\endgroup
\stopbuffer

\placetable
  [here]
  [tab:typescripts and typefaces]
  {The typescripts. Typescripts that use commercial fonts are typeset in bold. }
  {\getbuffer[typescripts]}

The predefined typescripts, the typefaces they define, the files
they are contained in inside the \CONTEXT\ distribution, and the
encodings they support in \MKII\ mode are listed in~\in {table}
[tab:typescripts and typefaces]. In the following section there is a 
table (\in {}[tab:typeface names]) that explains for each typescript 
what font set it attaches to each of the font styles.

\showsetup{usetypescriptfile}

For example, the following 

\startexample
\starttyping
\usetypescriptfile[type-buy]
\usetypescript[lucida][texnansi]
\setupbodyfont[lucida,12pt]
\stoptyping
\stopexample

will make \PDFTEX\ use the Lucida Bright font family. Because this is a commercial 
font, this only works correctly if you have actually bought and installed the fonts. 
This uses the \type{texnansi} encoding because that is the preferred encoding of the 
actual fonts.

This is a good moment to explain a little trick: because the various \type{type-xxx}
files define the building blocks for typescripts as well as the actual typescripts, 
it is sometimes possible to alter the effect of a typescript by
loading an extra typescript file. For example,

\starttyping
\usetypescriptfile[type-gyr]
\usetypescript[palatino][ec]
\setupbodyfont[palatino,12pt]
\stoptyping

will result in \PDFTEX\ using the Type~1 font Pagella from the \TeX\ Gyre project instead 
of the older and less complete URW Palladio, because the definition of the building blocks
for the \type{palatino} typescript that is in the \type{type-gyr} file overwrites the 
preloaded definition from the \type{type-one} file.

Two of the files in the \CONTEXT\ distribution exist precisely for this reason: 
\startitemize[packed]
\sym {\type{type-gyr.tex}} 

maps the typical PostScript font names for the free URW fonts 
to the \TeX\ Gyre set;
\sym {\type{type-akb.tex}} 

maps the same names to the commercial Adobe fonts. 
\stopitemize
For the defintions in the second file to work, you also need to execute an extra typescript:

\startexample
\starttyping
\usetypescriptfile [type-akb]
\usetypescript [adobekb] [ec]

\usetypescript [palatino] [ec]
\setupbodyfont[palatino,12pt]
\stoptyping
\stopexample

\subsection{Typeface definitions}

\macro{\tex{starttypescript}}
\macro{\tex{definetypeface}}

Defining a typeface goes like this:

\startexample
\starttyping
\starttypescript [palatino] [texnansi,ec,qx,t5,default]

\definetypeface[palatino] [rm] [serif][palatino] [default]
\definetypeface[palatino] [ss] [sans] [modern]   [default] [rscale=1.075]
\definetypeface[palatino] [tt] [mono] [modern]   [default] [rscale=1.075]
\definetypeface[palatino] [mm] [math] [palatino] [default]

\stoptypescript
\stoptyping
\stopexample

This defines a typescript named \type{palatino} in five different encodings.
When this typescript is executed via \type{\usetypescript}, it will define
four typefaces, one of each of the four basic styles \type{rm}, \type{ss}, \type{tt}, and \type{mm}. 

\showsetup{definetypeface} % empty at the moment

The third and fourth arguments to \type{\definetypeface} are pointers to already
declared font sets, these are defined elsewhere. \in{Table}[tab:typeface names] 
gives the full list of predefined typescripts (the first argument of \type{\starttypescript}) 
and font sets  that are attached to the styles (the third and fourth argument of 
each \type{\definetypeface}). 

The names in the third argument (like \type{serif} and \type{sans}) do {\em not\/} have the
same meaning as the names used in \type{\setupbodyfont}. Inside \type{\setupbodyfont}, they
were keywords that were internally remapped to one of the two-letter internal styles. Inside
\type{\definetypeface}, they are nothing more than convenience names that are  attached to a 
group of fonts by the person that wrote the font definition. They only reflect a grouping
that the person believed that could be a single font style.  Oftentimes, these names are
identical to the official style keywords, just as the typescript and typeface names are often 
the same, but there can be (and are) different names altogether.

\startbuffer[simpletypescripts]
\vskip 1ex
\begingroup
\switchtobodyfont[9pt]
\starttabulate[|l||l|l|l|l|]
\NC {\bf Typescript  }\NC {\bf Style rm    }  \NC {\bf Style ss }      \NC {\bf Style tt}     \NC  {\bf Style mm }  \NC \FR
\NC OmegaLGC          \NC omega               \NC --                   \NC omega              \NC --                \NC \NR
\NC antykwa-torunska  \NC antykwa-torunska    \NC modern               \NC modern             \NC antykwa-torunska  \NC \NR
\NC cbgreek           \NC cbgreek             \NC cbgreek              \NC cbgreek            \NC --                \NC \NR
\NC cbgreek-all       \NC cbgreek             \NC cbgreek              \NC cbgreek            \NC --                \NC \NR
\NC cbgreek-medium    \NC cbgreek             \NC cbgreek              \NC cbgreek            \NC --                \NC \NR
\NC cow               \NC cow                 \NC cow serif            \NC modern             \NC cow               \NC \NR
\NC fallback          \NC modern              \NC modern               \NC modern             \NC modern            \NC \NR
\NC fourier           \NC fourier             \NC modern               \NC modern             \NC fourier           \NC \NR
\NC iwona             \NC modern              \NC iwona                \NC modern             \NC iwona             \NC \NR
\NC iwona-heavy       \NC modern              \NC iwona-heavy          \NC modern             \NC iwona-heavy       \NC \NR
\NC iwona-light       \NC modern              \NC iwona-light          \NC modern             \NC iwona-light       \NC \NR
\NC iwona-medium      \NC modern              \NC iwona-medium         \NC modern             \NC iwona-medium      \NC \NR
\NC lucida            \NC lucida              \NC lucida               \NC lucida             \NC lucida            \NC \NR
\NC lucidabfm         \NC lucida              \NC lucida               \NC lucida             \NC lucida bfmath     \NC \NR
\NC lucidaboldmath    \NC lucida              \NC lucida               \NC lucida             \NC lucida boldmath   \NC \NR
\NC modern            \NC modern              \NC modern               \NC modern             \NC modern            \NC \NR
\NC modern-base       \NC (computer-)modern   \NC (computer-)modern    \NC (computer-)modern  \NC (computer-)modern \NC \NR
\NC modernvariable    \NC simple              \NC modern               \NC modern             \NC modern            \NC \NR
\NC optima            \NC palatino            \NC optima-nova          \NC modern             \NC palatino          \NC \NR
\NC optima-nova       \NC optima-nova sans    \NC optima-nova          \NC latin-modern       \NC latin-modern      \NC \NR
\NC optima-nova-os    \NC optima-nova-os sans \NC optima-nova-os       \NC latin-modern       \NC latin-modern      \NC \NR
\NC palatino          \NC palatino-nova       \NC palatino-sans        \NC latin-modern       \NC latin-modern      \NC \NR
\NC palatino          \NC palatino            \NC modern               \NC modern             \NC palatino          \NC \NR
\NC palatino-informal \NC palatino-nova       \NC palatino-informal    \NC latin-modern       \NC latin-modern      \NC \NR
\NC palatino-light    \NC palatino-nova       \NC palatino-sans-light  \NC latin-modern       \NC latin-modern      \NC \NR
\NC palatino-medium   \NC palatino-nova       \NC palatino-sans-medium \NC latin-modern       \NC latin-modern      \NC \NR
\NC palatino-normal   \NC palatino-nova       \NC palatino-sans-normal \NC latin-modern       \NC latin-modern      \NC \NR
\NC palatino-nova     \NC palatino-nova       \NC palatino-sans        \NC latin-modern       \NC latin-modern      \NC \NR
\NC palatino-sans     \NC palatino-nova       \NC palatino-sans        \NC latin-modern       \NC latin-modern      \NC \NR
\NC postscript        \NC times               \NC helvetica            \NC courier            \NC times             \NC \NR
\NC sheep             \NC sheep               \NC sheep serif          \NC modern             \NC sheep             \NC \NR
\NC times             \NC times               \NC helvetica            \NC modern             \NC times             \NC \NR
\stoptabulate
\endgroup
\vskip 1ex
\stopbuffer

\placetable
  [here]
  [tab:typeface names]
  {The typescripts.\crlf 
   Unless stated otherwise, style {\bf rm} uses a group named serif, style {\bf ss} uses sans, style {\bf tt} uses
   mono, and style {\bf mm} uses math.
   A single dash in a cell means that the typescript does not define that style, you should refrain from using the style.
   The lucida, lucidabfm, and lucidaboldmath typescripts also define {\bf hw} and {\bf cg} as \quote{lucida handwring} 
   and \quote{lucida calligraphy}.
   The modern-base typescript switches back to computer-modern for a few legacy encodings: t2a, t2b, and t2c.}
  {\getbuffer[simpletypescripts]}

How to define your own font sets will be explained in the next chapter,
but there are quite a few predefined font sets that come with \CONTEXT;
these are all listed in the four tables~\in{}[tab:body font names 1],
\in{}[tab:body font names 2], \in{}[tab:body font names 3], 
and \in{}[tab:body font names 4]. 

For everything to work properly in \MKII, the predefined font sets also have to have an
encoding attached, you can look those up in the relevant tables as well. 

The fifth argument to \type{\definetypeface} specifies specific font size setups (if any), 
these will be covered in~\in{section}[typefacesizes] in the next chapter. Almost always,
specifying \type{default} will suffice.

The optional sixth argument is used for tweaking font settings like the specification of
font features or adjusting parameters. In this case, the two \type{modern} font sets are
loaded with a small magnification, this evens out the visual heights of the font styles.

\startbuffer
\vskip 1ex
\starttabulate[|lT|l|p|]
\NC \rm\bf key \NC \bf default value        \NC explanation                             \NC \FR
\NC rscale   \NC 1                       \NC a scaling factor for this typescript
                                             relative to the selected body font size \NC \NR
\NC encoding \NC \type{\defaultencoding} \NC the encoding for the typeface, normally
                                             inherited from the typescript
                                             automatically                           \NC \NR
\NC features \NC                         \NC this applies a predefined font feature set 
                                             (see~\in{section}[sec:font features])   \NC \NR
\NC text     \NC                         \NC sets up the forced math text style      \NC \NR
\stoptabulate 
\vskip 1ex
\stopbuffer


There are four possible keys in the sixth argument:

\getbuffer

A note for the lazy: if the sixth argument is not given and the fifth argument happens
to be \type{default}, then the fifth argument can be omitted as well.

\startbuffer[bodyfontst1free]
\switchtobodyfont[9pt]
\starttabulate[|l|l|l|p(3.5cm)|]
\NC \bf Identifier             \NC \bf file  \NC \bf Encodings               \NC \bf Supported styles \NC \FR
\NC modern                     \NC type-one  \NC ec, qx, texnansi, t5        \NC serif, sans, mono, math, \crlf
                                                                                 boldmath, bfmath \NC \NR 
\NC latin-modern               \NC type-one  \NC ec, qx, texnansi, t5        \NC serif, sans, mono, math, \crlf 
                                                                                 boldmath, bfmath \NC \NR 
\NC computer-modern            \NC type-one  \NC t2a/b/c                     \NC serif, sans, mono, math, \crlf %removed lcy,cyr,x2
                                                                                 boldmath, bfmath \NC \NR 
\NC simple                     \NC type-one  \NC -- synonyms only --         \NC serif \NC \NR 
\NC concrete                   \NC type-one  \NC -- hardcoded --             \NC serif \NC \NR
\NC euler                      \NC type-one  \NC -- hardcoded --             \NC math, boldmath, bfmath\NC \NR
\NC ams                        \NC type-one  \NC -- hardcoded --             \NC math\NC \NR
\NC fourier                    \NC type-one  \NC ec                          \NC math, serif \NC \NR
\NC courier                    \NC type-one  \NC 8r, ec, qx, texnansi, t5    \NC mono \NC \NR
\NC helvetica                  \NC type-one  \NC 8r, ec, qx, texnansi, t5    \NC sans \NC \NR
\NC times                      \NC type-one  \NC 8r, ec, qx, texnansi, t5    \NC serif, math \NC \NR
\NC palatino                   \NC type-one  \NC 8r, ec, qx, texnansi, t5    \NC serif, math \NC \NR
\NC bookman                    \NC type-one  \NC 8r, ec, qx, texnansi, t5    \NC serif \NC \NR
\NC schoolbook                 \NC type-one  \NC 8r, ec, texnansi, t5        \NC serif \NC \NR
\NC chancery                   \NC type-one  \NC 8r, ec, qx, texnansi        \NC calligraphy \NC \NR
\NC charter                    \NC type-one  \NC 8r, ec, texnansi            \NC serif \NC \NR
\NC utopia                     \NC type-one  \NC ec, texnansi                \NC serif \NC \NR
\NC antykwa-torunska           \NC type-one  \NC ec, qx, texnansi, t5, t2a/b/c, greek \NC serif, math \NR
\NC antykwa-torunska-light     \NC type-one  \NC ec, qx, texnansi, t5, t2a/b/c, greek \NC serif, math \NR
\NC antykwa-torunska-cond      \NC type-one  \NC ec, qx, texnansi, t5, t2a/b/c, greek \NC serif, math \NR
\NC antykwa-torunska-lightcond \NC type-one  \NC ec, qx, texnansi, t5, t2a/b/c, greek \NC serif, math \NR
\NC antykwa-poltawskiego       \NC type-one  \NC 8r, ec, texnansi                   \NC serif \NR
\NC iwona                      \NC type-one  \NC ec, qx, texnansi, t5               \NC sans, math \NC \NR
\NC iwona-light                \NC type-one  \NC ec, qx, texnansi, t5               \NC sans, math \NC \NR
\NC iwona-medium               \NC type-one  \NC ec, qx, texnansi, t5               \NC sans, math \NC \NR
\NC iwona-heavy                \NC type-one  \NC ec, qx, texnansi, t5               \NC sans, math \NC \NR
\NC iwona-cond                 \NC type-one  \NC ec, qx, texnansi, t5               \NC sans \NC \NR
\NC iwona-light-cond           \NC type-one  \NC ec, qx, texnansi, t5               \NC sans \NC \NR
\NC iwona-medium-cond          \NC type-one  \NC ec, qx, texnansi, t5               \NC sans \NC \NR
\NC iwona-heavy-cond           \NC type-one  \NC ec, qx, texnansi, t5               \NC sans \NC \NR
\NC kurier                     \NC type-one  \NC ec, qx, texnansi, t5               \NC sans, math \NC \NR
\NC kurier-light               \NC type-one  \NC ec, qx, texnansi, t5               \NC sans, math \NC \NR
\NC kurier-medium              \NC type-one  \NC ec, qx, texnansi, t5               \NC sans, math \NC \NR
\NC pagella                    \NC type-gyr  \NC ec, qx, texnansi, t5, t2a/b/c      \NC serif\NC \NR % removed encs: rm,el, ec, cs, l7x
\NC palatino                   \NC type-gyr  \NC ec, qx, texnansi, t5, t2a/b/c      \NC serif\NC \NR
\NC termes                     \NC type-gyr  \NC ec, qx, texnansi, t5, t2a/b/c      \NC serif\NC \NR
\NC times                      \NC type-gyr  \NC ec, qx, texnansi, t5, t2a/b/c      \NC serif\NC \NR
\NC bonum                      \NC type-gyr  \NC ec, qx, texnansi, t5, t2a/b/c      \NC serif\NC \NR
\NC bookman                    \NC type-gyr  \NC ec, qx, texnansi, t5, t2a/b/c      \NC serif\NC \NR
\NC schola                     \NC type-gyr  \NC ec, qx, texnansi, t5, t2a/b/c      \NC serif\NC \NR
\NC schoolbook                 \NC type-gyr  \NC ec, qx, texnansi, t5, t2a/b/c      \NC serif\NC \NR
\NC heros                      \NC type-gyr  \NC ec, qx, texnansi, t5, t2a/b/c      \NC sans\NC \NR
\NC helvetica                  \NC type-gyr  \NC ec, qx, texnansi, t5, t2a/b/c      \NC sans\NC \NR
\NC adventor                   \NC type-gyr  \NC ec, qx, texnansi, t5, t2a/b/c      \NC sans\NC \NR
\NC cursor                     \NC type-gyr  \NC ec, qx, texnansi, t5, t2a/b/c      \NC mono\NC \NR
\NC courier                    \NC type-gyr  \NC ec, qx, texnansi, t5, t2a/b/c      \NC mono\NC \NR
\NC omega                      \NC type-omg  \NC -- hardcoded --                    \NC naskh, serif, mono\NC \NR
\NC cbgreek                    \NC type-cbg  \NC -- hardcoded --                    \NC serif, sans, mono \NC \NR
\NC cbgreek-medium             \NC type-cbg  \NC -- hardcoded --                    \NC serif, sans, mono \NC \NR
\NC cbgreek-all                \NC type-cbg  \NC -- hardcoded --                    \NC serif, sans, mono \NC \NR
\NC cow                        \NC type-cow  \NC -- hardcoded --                    \NC math, serif \NC \NR
\NC sheep                      \NC type-cow  \NC -- hardcoded --                    \NC math, serif \NC \NR

\stoptabulate
\stopbuffer

%\NC Identifier           \NC Needed font package              
%\NC modern               \NC Latin Modern              \NC \NR 
%\NC latin-modern         \NC Latin Modern              \NC \NR 
%\NC computer-modern      \NC Latin Modern              \NC \NR 
%\NC simple               \NC Latin Modern              \NC \NR 
%\NC concrete             \NC -- MF bitmaps --          \NC \NR
%\NC euler                \NC Euler                     \NC \NR
%\NC ams                  \NC AMS Symbols               \NC \NR
%\NC fourier              \NC Fourier                   \NC \NR
%\NC courier              \NC URW PostScript (or Adobe) \NC \NR
%\NC helvetica            \NC URW PostScript (or Adobe) \NC \NR
%\NC times                \NC URW PostScript (or Adobe) \NC \NR
%\NC palatino             \NC URW PostScript (or Adobe) \NC \NR
%\NC bookman              \NC URW PostScript (or Adobe) \NC \NR
%\NC schoolbook           \NC URW PostScript (or Adobe) \NC \NR
%\NC chancery             \NC URW PostScript (or Adobe) \NC \NR
%\NC charter              \NC Bitstream Charter         \NC \NR
%\NC utopia               \NC Adobe Utopia              \NC \NR
%\NC antykwa-torunska-xx  \NC Antykwa Torunska          \NC \NR
%\NC antykwa-poltawskiego \NC Antykwa Poltawskiego      \NC \NR
%\NC iwona-xx             \NC Iwona                     \NC \NR
%\NC kurier-xx            \NC Kurier                    \NC \NR
%\NC pagella              \NC TeX Gyre                  \NC \NR
%\NC palatino             \NC TeX Gyre                  \NC \NR
%\NC termes               \NC TeX Gyre                  \NC \NR
%\NC times                \NC TeX Gyre                  \NC \NR
%\NC bonum                \NC TeX Gyre                  \NC \NR
%\NC bookman              \NC TeX Gyre                  \NC \NR
%\NC schola               \NC TeX Gyre                  \NC \NR
%\NC schoolbook           \NC TeX Gyre                  \NC \NR
%\NC heros                \NC TeX Gyre                  \NC \NR
%\NC helvetica            \NC TeX Gyre                  \NC \NR
%\NC adventor             \NC TeX Gyre                  \NC \NR
%\NC cursor               \NC TeX Gyre                  \NC \NR
%\NC courier              \NC TeX Gyre                  \NC \NR
%\NC omega                \NC Omega fonts               \NC \NR
%\NC cbgreek-xx           \NC cbgreek                   \NC \NR
%\NC cow                  \NC \CONTEXT\ cow font        \NC \NR
%\NC sheep                \NC \CONTEXT\ cow font        \NC \NR


\startbuffer[bodyfontst1buy]
\switchtobodyfont[9pt]
\starttabulate[|l|l|l|p(4.5cm)|]
\NC \bf Identifier       \NC \bf file  \NC \bf Encodings      \NC \bf Supported styles \NC \FR
\NC lucida               \NC type-buy  \NC 8r, ec, texnansi   \NC serif, sans, mono, handwriting,\crlf 
                                                                  calligraphy, math, boldmath, \crlf
                                                                  bfmath, casual, fax \NC \NR
\NC informal             \NC type-buy \NC -- hardcoded --     \NC casual, math\NC \NR
\NC officina             \NC type-buy \NC 8r, ec, texnansi    \NC serif, sans\NC \NR
\NC meta                 \NC type-buy \NC 8r, ec, texnansi    \NC serif, sans, expert \NC \NR
\NC meta-medium          \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC meta-lf              \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC meta-book            \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC meta-book-lf         \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC meta-bold            \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC meta-bold-lf         \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC meta-normal          \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC meta-normal-lf       \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC meta-medium          \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC meta-medium-lf       \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC meta-black           \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC meta-black-lf        \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC univers              \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC univers-light        \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC univers-black        \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC mendoza              \NC type-buy \NC 8r, ec, texnansi    \NC serif \NC \NR
\NC frutiger             \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC kabel                \NC type-buy \NC 8r, ec, texnansi    \NC sans \NC \NR
\NC thesans              \NC type-buy \NC 8r, ec, texnansi    \NC sans, mono, expert \NC \NR
\NC sabon                \NC type-buy \NC 8r, ec, texnansi    \NC serif \NC \NR
\NC stone                \NC type-buy \NC ec, texnansi        \NC serif, sans \NC \NR
\NC stone-oldstyle       \NC type-buy \NC -- synonyms only -- \NC serif, sans \NC \NR
\NC industria            \NC type-buy \NC ec, texnansi        \NC sans \NC \NR
\NC bauhaus              \NC type-buy \NC ec, texnansi        \NC sans \NC \NR
\NC swift                \NC type-buy \NC ec, texnansi        \NC serif \NC \NR
\NC swift-light          \NC type-buy \NC -- synonyms only -- \NC serif \NC \NR
\NC syntax               \NC type-buy \NC ec, texnansi        \NC sans \NC \NR
\NC linoletter           \NC type-buy \NC ec, texnansi        \NC serif \NC \NR
\NC zapfino              \NC type-ghz \NC 8r, ec, texnansi    \NC serif, handwriting\NC \NR
\NC palatino-sans-light  \NC type-exp \NC texnansi, ec        \NC sans\NC \NR
\NC palatino-sans-normal \NC type-exp \NC texnansi, ec        \NC sans\NC \NR
\NC palatino-sans-medium \NC type-exp \NC texnansi, ec        \NC sans\NC \NR
\NC opus                 \NC type-fsf \NC 8r, ec, texnansi    \NC sans\NC \NR
\NC typewriter           \NC type-fsf \NC 8r, ec, texnansi    \NC mono\NC \NR
\NC garamond             \NC type-fsf \NC 8r, ec, texnansi    \NC serif\NC \NR
\NC optima               \NC type-ghz \NC 8r, ec, texnansi    \NC sans\NC \NR
\NC optima-nova          \NC type-ghz \NC 8r, ec, texnansi    \NC sans\NC \NR
\NC optima-nova-os       \NC type-ghz \NC 8r, ec, texnansi    \NC sans\NC \NR
\NC optima-nova-light    \NC type-ghz \NC 8r, ec, texnansi    \NC sans\NC \NR
\NC optima-nova-medium   \NC type-ghz \NC 8r, ec, texnansi    \NC sans\NC \NR
\NC palatino             \NC type-ghz \NC 8r, ec, texnansi    \NC serif\NC \NR
\NC palatino-nova        \NC type-ghz \NC 8r, ec, texnansi    \NC serif\NC \NR
\NC palatino-nova-os     \NC type-ghz \NC 8r, ec, texnansi    \NC serif\NC \NR
\NC palatino-nova-light  \NC type-ghz \NC 8r, ec, texnansi    \NC serif\NC \NR
\NC palatino-nova-medium \NC type-ghz \NC 8r, ec, texnansi    \NC serif\NC \NR
\NC aldus-nova           \NC type-ghz \NC 8r, ec, texnansi    \NC serif\NC \NR
\NC melior               \NC type-ghz \NC 8r, ec, texnansi    \NC serif\NC \NR
\NC verdana              \NC type-msw \NC texnansi            \NC sans\NC \NR
\NC arial                \NC type-msw \NC texnansi            \NC sans\NC \NR
\stoptabulate									         
\stopbuffer									         

%\NC Identifier           \NC Needed font package    \NC \NR
%\NC lucida               \NC Lucida (Y\&Y, TUG)     \NC \NR
%\NC informal             \NC Micropress Informal    \NC \NR
%\NC officina             \NC ITC Officina           \NC \NR
%\NC meta-xx              \NC FF Meta                \NC \NR
%\NC univers-xx           \NC Linotype Univers       \NC \NR
%\NC mendoza              \NC Mendoza                \NC \NR
%\NC frutiger             \NC Frutiger               \NC \NR
%\NC kabel                \NC ITC Kabel              \NC \NR
%\NC thesans              \NC FF The Sans            \NC \NR
%\NC sabon                \NC Monotype Sabon         \NC \NR
%\NC stone-xx             \NC ITC Stone              \NC \NR
%\NC industria            \NC Linotype Industria     \NC \NR
%\NC bauhaus              \NC ITC Bauhaus            \NC \NR
%\NC swift                \NC EF Swift               \NC \NR
%\NC swift-light          \NC EF Swift               \NC \NR
%\NC syntax               \NC Linotype Syntax        \NC \NR
%\NC linoletter           \NC Linotype Linoletter    \NC \NR
%\NC zapfino              \NC ZapfinoT1              \NC \NR
%\NC palatino-sans-xx     \NC Palatino Sans Nova T1  \NC \NR
%\NC opus                 \NC Fontsite 500 Opus      \NC \NR
%\NC typewriter           \NC Fontsite 500 Typewriter\NC \NR
%\NC garamond             \NC Fontsite 500 Garamond  \NC \NR
%\NC optima-xx            \NC Optima Nova T1         \NC \NR
%\NC palatino-xx          \NC Palatino Nova T1       \NC \NR
%\NC aldus-nova           \NC Aldus Nova T1          \NC \NR
%\NC melior               \NC Melior T1              \NC \NR
%\NC verdana              \NC Microsoft Windows      \NC \NR
%\NC arial                \NC Microsoft Windows      \NC \NR


\startbuffer[bodyfontsotffree]
\switchtobodyfont[9pt]
\starttabulate[|l|l|l|]
\NC \bf Identifier             \NC \bf file \NC \bf Supported styles \NC \FR
\NC modern                     \NC type-otf \NC serif, sans, mono, math, boldmath, bfmath \NC \NR 
\NC latin-modern               \NC type-otf \NC serif, sans, mono, math, boldmath, bfmath \NC \NR 
\NC modern-vari                \NC type-otf \NC mono \NC \NR 
\NC latin-modern-vari          \NC type-otf \NC mono \NC \NR 
\NC modern-cond                \NC type-otf \NC mono \NC \NR 
\NC latin-modern-cond          \NC type-otf \NC mono \NC \NR 
\NC computer-modern            \NC type-otf \NC serif, sans, mono, math, boldmath, bfmath \NC \NR 
\NC concrete                   \NC type-otf \NC serif \NC \NR
\NC euler                      \NC type-otf \NC math, boldmath, bfmath\NC \NR
\NC ams                        \NC type-otf \NC math \NC \NR
\NC pagella                    \NC type-otf \NC serif \NC \NR
\NC termes                     \NC type-otf \NC serif \NC \NR
\NC bonum                      \NC type-otf \NC serif \NC \NR
\NC schola                     \NC type-otf \NC serif \NC \NR
\NC chorus                     \NC type-otf \NC serif \NC \NR
\NC heros                      \NC type-otf \NC sans \NC \NR
\NC adventor                   \NC type-otf \NC sans \NC \NR
\NC cursor                     \NC type-otf \NC sans \NC \NR
\NC palatino                   \NC type-otf \NC serif, math \NC \NR
\NC times                      \NC type-otf \NC serif, math \NC \NR
\NC bookman                    \NC type-otf \NC serif \NC \NR
\NC schoolbook                 \NC type-otf \NC serif \NC \NR
\NC chancery                   \NC type-otf \NC calligraphy \NC \NR
\NC helvetica                  \NC type-otf \NC sans \NC \NR
\NC courier                    \NC type-otf \NC mono \NC \NR
\NC antykwa-torunska           \NC type-otf \NC serif, math \NC \NR
\NC antykwa-torunska-light     \NC type-otf \NC serif, math \NC \NR
\NC antykwa-torunska-cond      \NC type-otf \NC serif, math \NC \NR
\NC antykwa-torunska-lightcond \NC type-otf \NC serif, math \NC \NR
\NC antykwa-poltawskiego       \NC type-otf \NC serif \NC \NR
\NC iwona-light                \NC type-otf \NC sans, math \NC \NR
\NC iwona                      \NC type-otf \NC sans, math \NC \NR
\NC iwona-medium               \NC type-otf \NC sans, math \NC \NR
\NC iwona-heavy                \NC type-otf \NC sans, math \NC \NR
\NC iwona-cond                 \NC type-otf \NC sans \NC \NR
\NC iwona-light-cond           \NC type-otf \NC sans \NC \NR
\NC iwona-medium-cond          \NC type-otf \NC sans \NC \NR
\NC iwona-heavy-cond           \NC type-otf \NC sans \NC \NR
\NC kurier                     \NC type-otf \NC sans, math \NC \NR
\NC kurier-light               \NC type-otf \NC sans, math \NC \NR
\NC kurier-medium              \NC type-otf \NC sans, math \NC \NR
\NC charter                    \NC type-otf \NC serif \NC \NR
\NC gentium                    \NC type-xtx \NC serif \NC \NR
\stoptabulate
\stopbuffer

%\NC Identifier                 \NC Needed font package    \NC \NR
%\NC modern                     \NC Latin Modern           \NC \NR
%\NC latin-modern               \NC Latin Modern           \NC \NR
%\NC modern-vari                \NC Latin Modern           \NC \NR
%\NC latin-modern-vari          \NC Latin Modern           \NC \NR
%\NC modern-cond                \NC Latin Modern           \NC \NR
%\NC latin-modern-cond          \NC Latin Modern           \NC \NR
%\NC computer-modern            \NC Latin Modern           \NC \NR
%\NC concrete                   \NC -- MF bitmaps --       \NC \NR
%\NC euler                      \NC Euler                  \NC \NR
%\NC ams                        \NC AMS                    \NC \NR
%\NC pagella                    \NC TeX Gyre               \NC \NR
%\NC termes                     \NC TeX Gyre               \NC \NR
%\NC bonum                      \NC TeX Gyre               \NC \NR
%\NC schola                     \NC TeX Gyre               \NC \NR
%\NC chorus                     \NC TeX Gyre               \NC \NR
%\NC heros                      \NC TeX Gyre               \NC \NR
%\NC adventor                   \NC TeX Gyre               \NC \NR
%\NC cursor                     \NC TeX Gyre               \NC \NR
%\NC palatino                   \NC TeX Gyre               \NC \NR
%\NC times                      \NC TeX Gyre               \NC \NR
%\NC bookman                    \NC TeX Gyre               \NC \NR
%\NC schoolbook                 \NC TeX Gyre               \NC \NR
%\NC chancery                   \NC TeX Gyre               \NC \NR
%\NC helvetica                  \NC TeX Gyre               \NC \NR
%\NC courier                    \NC TeX Gyre               \NC \NR
%\NC antykwa-torunska           \NC Antykwa Torunska       \NC \NR
%\NC antykwa-torunska-light     \NC Antykwa Torunska       \NC \NR
%\NC antykwa-torunska-cond      \NC Antykwa Torunska       \NC \NR
%\NC antykwa-torunska-lightcond \NC Antykwa Torunska       \NC \NR
%\NC antykwa-poltawskiego       \NC Antykwa Poltawskiego   \NC \NR
%\NC iwona-xx                   \NC Iwona                  \NC \NR
%\NC kurier-xx                  \NC Kurier                 \NC \NR
%\NC charter                    \NC Bitstream Charter      \NC \NR
%\NC gentium                    \NC SIL Gentium            \NC \NR

\startbuffer[bodyfontsotfbuy]
\switchtobodyfont[9pt]

\starttabulate[|l|l|l|]
\NC \bf Identifier                 \NC \bf file \NC \bf Supported styles \NC \FR
\NC zapfino                        \NC type-hgz \NC serif, handwriting\NC \NR
\NC optima-nova                    \NC type-hgz \NC sans\NC \NR
\NC optima-nova-os                 \NC type-hgz \NC sans\NC \NR
\NC optima-nova-light              \NC type-hgz \NC sans\NC \NR
\NC optima-nova-medium             \NC type-hgz \NC sans\NC \NR
\NC palatino-nova                  \NC type-hgz \NC serif\NC \NR
\NC palatino-nova-os               \NC type-hgz \NC serif\NC \NR
\NC palatino-nova-light            \NC type-hgz \NC serif\NC \NR
\NC palatino-nova-medium           \NC type-hgz \NC serif\NC \NR
\NC palatino-sans                  \NC type-hgz \NC sans\NC \NR
\NC palatino-informal              \NC type-hgz \NC sans\NC \NR
\NC melior                         \NC type-hgz \NC serif\NC \NR
\NC -- all four-variant fonts --   \NC type-xtx \NC Xserif \NC \NR
\NC -- all four-variant fonts --   \NC type-xtx \NC Xsans \NC \NR
\NC -- all four-variant fonts --   \NC type-xtx \NC Xmono \NC \NR
\NC times                          \NC type-xtx \NC serif \NC \NR
\NC palatino                       \NC type-xtx \NC serif \NC \NR
\NC helvetica                      \NC type-xtx \NC sans \NC \NR
\NC courier                        \NC type-xtx \NC mono \NC \NR
\NC hoefler                        \NC type-xtx \NC serif \NC \NR
\NC lucidagrande                   \NC type-xtx \NC sans \NC \NR
\NC optima                         \NC type-xtx \NC sans \NC \NR
\NC gillsans                       \NC type-xtx \NC sans \NC \NR
\NC gillsanslt                     \NC type-xtx \NC sans \NC \NR
\NC zapfino                        \NC type-xtx \NC handwriting, serif \NC \NR
\NC applechancery                  \NC type-xtx \NC calligraphy, serif \NC \NR
\NC timesnewroman                  \NC type-xtx \NC serif \NC \NR
\NC arial                          \NC type-xtx \NC sans \NC \NR
\NC lucida                         \NC type-xtx \NC serif, sans, mono, handwriting, calligraphy, fax\NC \NR
\stoptabulate
\stopbuffer

%\NC Identifier                 \NC Needed font package    \NC \NR
%\NC zapfino                    \NC Zapfino Pro OTF        \NC \NR
%\NC optima-nova-xx             \NC Optima Nova OTF        \NC \NR
%\NC palatino-nova-xx           \NC Palatino Nova OTF      \NC \NR
%\NC melior                     \NC Melior OTF             \NC \NR
%\NC times                      \NC MacOSX                 \NC \NR
%\NC palatino                   \NC MacOSX (Book Antiqua)  \NC \NR
%\NC helvetica                  \NC MacOSX (Helvetica Neue)\NC \NR
%\NC courier                    \NC MacOSX                 \NC \NR
%\NC hoefler                    \NC MacOSX                 \NC \NR
%\NC lucidagrande               \NC MacOSX                 \NC \NR
%\NC optima                     \NC MacOSX                 \NC \NR
%\NC gillsans                   \NC MacOSX                 \NC \NR
%\NC gillsanslt                 \NC MacOSX                 \NC \NR
%\NC zapfino                    \NC MacOSX                 \NC \NR
%\NC applechancery              \NC MacOSX                 \NC \NR
%\NC timesnewroman              \NC MS Office              \NC \NR
%\NC arial                      \NC MS Office              \NC \NR
%\NC lucida                     \NC MS Office              \NC \NR

\placetable
  [here]
  [tab:body font names 1]
  {The predefined body font identifiers for free Type~1 and \METAFONT\ fonts}
  {\getbuffer[bodyfontst1free]}


\placetable
  [here]
  [tab:body font names 2]
  {The predefined body font identifiers for commercial Type~1 fonts}
  {\getbuffer[bodyfontst1buy]}

\placetable
  [here]
  [tab:body font names 3]
  {The predefined body font identifiers for free Unicode (Opentype) fonts}
  {\getbuffer[bodyfontsotffree]}


\placetable
  [here]
  [tab:body font names 4]
  {The predefined body font identifiers for commercial Unicode (Opentype) fonts}
  {\getbuffer[bodyfontsotfbuy]}


In~\in{table}[tab:body font names 4] you will see three very special items: \type{Xserif},  \type{Xsans} and \type{Xmono}. These
belong to a special \XETEX-only trick called \quote{wildcard typescripts}.

\XETEX\ offers some nice features in terms of automatically finding related fonts in a family, namely the italic, bold, and
bolditalic alternatives. To take advantage of that, there's a set of wildcard typescripts that take an arbitrary Macintosh font
name as input, and provide as many of the alternatives it can find. To set these typescripts (and the calling conventions) apart
from the familiar ones, the typescripts are identified with \type{Xserif}, \type{Xsans}, and \type{Xmono}. 

To call the typescripts, it's most convenient to define a typeface that uses these features. The named font slot should contain the
display name of the Regular alternative (not the family name) of the font in question.  For example, you could have the
following mix:

\startexample
\starttyping
\starttypescript[myface]
\definetypeface[myface][rm][Xserif][Baskerville]   [default]
\definetypeface[myface][tt][Xmono] [Courier]       [default][rscale=.87]
\definetypeface[myface][ss][Xsans] [Optima Regular][default]
\stoptypescript
\stoptyping
\stopexample

As you can see, you can activate relative scaling of face sizes. The above definitions look very much like any other typeface
definition, except that the serif/sans/mono identifier is preceded with X, and that there is no underlying "Optima Regular" defined
anywhere. Those missing bits of the definitions are handled by typescript and \XETEX\ magic.

\subsection[sec:body font environment]{Body font environments}

\macro{\tex{setupbodyfontenvironment}}
\macro{\tex{definebodyfontenvironment}}

Earlier we have seen that within a font family there are
different font sizes. The relations between these sizes
are defined by {\em body font environments}.

For all regular font sizes, environments are predefined
that fulfill their purpose adequately. However when you want
to do some extra defining yourself there is:

\showsetup{definebodyfontenvironment}


The first argument is optional, and specifier the typeface identifier 
that this particular body font environment setup is for.
It defaults to the current typeface.

The second argument is the size of the body font environment that is being defined.  This
argument is not really optional, the macro syntax description is a little misleading.

The third argument once again is optional, and contains the actual settings
as key-value pairs. If it is missing, defaults will be guessed at
by \CONTEXT\ itself.

\starttabulate[|lT|p|]
\NC text           \NC Math text size\NC \NR
\NC script         \NC Math script size\NC \NR
\NC scriptscript   \NC Math scriptscript size\NC \NR
\NC x              \NC The size used for the \type{\tfx} etc. commands\NC \NR
\NC xx             \NC The size used for the \type{\tfxx} command\NC \NR
\NC big            \NC The \quote{larger} font size\NC \NR
\NC small          \NC The \quote{smaller} font size\NC \NR
\NC interlinespace \NC Distance between lines in a paragraph, can be ignored
                       because a reasonable default is always set up\NC \NR
\NC em             \NC The style to use for emphasis (default is \type{slanted})\NC \NR
\stoptabulate 

So, when you want to have a somewhat bigger fontsize for 
just a few words (e.g. for a book title) you can type:

\startexample
\starttyping
\definebodyfontenvironment [24pt]
\switchtobodyfont[24pt]
\stoptyping
\stopexample

but longer stretches of text, you will need to set up most of the values, using 
something like this 

\startexample
\starttyping
\definebodyfontenvironment
  [22pt]
  [        text=22pt,
         script=17.3pt,
   scriptscript=14.4pt,
              x=17.3pt,
             xx=14.4pt,
            big=28pt,
          small=17.3pt]
\stoptyping
\stopexample

To tweak already defined sizes, there is an accompagnying setup command with the same
parameter conventions:

\showsetup{setupbodyfontenvironment}

\section[sec:font features]{Font feature sets}

\macro{\tex{definefontfeature}}

As mentioned already, some fonts contain extra information besides the actual glyph
shapes. In traditional \TEX\ fonts, the extra information is roughly limited to kerning
pairs and ligature information, and both of these \quote{features} are automatically
applied to the text that is being typeset.  In the odd case where one of the two needs to
be suppressed, a little bit of macro trickery can do the job without too many
complicating factors.

But with the new OpenType font format that is used by \XETEX\ and \LUATEX, the list of
possible features is increased enormously. OpenType fonts have not just kerning
information and ligature information, but there can also be other features like optional
oldstyle figures, caps and smallcaps glyphs, decorative swashes, etc.  all inside a 
single font file. 

Not only that, but some of these features are not even supposed to be active all the
time. Certain features should only be activated if the user asks for it, other features
depend on the script and language that is in use for the text that is being typeset.

This is a big step forward in that there are now far fewer fonts needed to achieve the
same level of quality than before, all that extra font information also poses a big
challenge for macro writers. And add to that the fact that at the core, the two engines 
(\XETEX\ and  \LUATEX) handle OpenType fonts completely different from each other.

\CONTEXT\ has a new subsystem called \quote{font features} to create order in this forest
of features. The most important command is \type{\definefontfeature}. This command can be
used to group various font features under a single symbolic name, that can then be used
as e.g. the argument to the \type{features} key of \type{\definetypeface}.

\showsetup{definefontfeature}

\startexample
\starttyping
\definefontfeature
   [default-base]
   [script=latn,language=dflt,liga=yes,kern=yes,tlig=yes,trep=yes]
\stoptyping
\stopexample

As you can probably guess, the first argument is the symbolic name that is being
defined. The second argument is a mix of a-hoc settings and OpenType font features.

\starttabulate[|lT|p|]
\NC compose   \NC Use fallback composition in \MKIV \NC \NR
\NC script    \NC An OpenType script identifier \NC \NR
\NC language  \NC An OpenType script language identifier \NC \NR
\NC tlig      \NC A virtual feature for legacy (\TEX-style) automatic ligatures 
                 (for compatibility, there is an alias for this key called
                  \type{texligatures})\NC \NR
\NC trep      \NC A virtual feature for legacy (\TEX-style) automatic ligatures
                  (for compatibility, there is an alias for this key called \type{texquotes})
                  (only works in \MKIV) \NC \NR
\NC mode      \NC Processing mode for \MKIV. 
                  \type{node} and \type{base} allowed, \type{base} is default\NC \NR
\NC <tag>     \NC Any OpenType feature tag is acceptable, but in \MKIV\
                  only a \quote{known} subset actually has any effect, and then
                  only in \type{node} mode. 
                  This list is given in~\in{table}[tab:mkivfeatures].
                  In \XETEX, processing depends on the internal subengine that
                  is used by \XETEX, and that is outside of \CONTEXT's control. \NC \NR
\stoptabulate

A few fontfeatures are predefined by context:

\startbuffer[predeffeatures]
\vskip 1ex
\starttabulate[|lT|lT|]
\NC  default  \NC liga=yes,kern=yes,tlig=yes,trep=yes          \NC \NR
\NC smallcaps \NC liga=yes,kern=yes,tlig=yes,trep=yes,smcp=yes \NC \NR
\NC oldstyle  \NC liga=yes,kern=yes,tlig=yes,trep=yes,onum=yes \NC \NR
\stoptabulate
\vskip 1ex
\stopbuffer

\getbuffer[predeffeatures]

At the moment, \type {smallcaps} and \type{oldstyle} only work in \XETEX\ 
(in \MKIV, it would need an extra \type{mode=node} pair).

\startbuffer[mkivfeatures]
\begingroup
\def\*#1#2#3#4{\ctxlua{tex.sprint(tex.vrbcatcodes,fonts.otf.tables.features["#1#2#3#4"])}}
\startsimplecolumns
\switchtobodyfont[9pt]
\starttabulate[|l|l|l|]
\NC aalt\NC \*aalt\NC \NC \NR
\NC abvm\NC \*abvm\NC \NC \NR
\NC afrc\NC \*afrc\NC \NC \NR
\NC akhn\NC \*akhn\NC \NC \NR
\NC blwm\NC \*blwm\NC \NC \NR
\NC c2pc\NC \*c2pc\NC \NC \NR
\NC c2sc\NC \*c2sc\NC \NC \NR
\NC calt\NC \*calt\NC \NC \NR
\NC case\NC \*case\NC \NC \NR
\NC ccmp\NC \*ccmp\NC \NC \NR
\NC clig\NC \*clig\NC \NC \NR
\NC cpsp\NC \*cpsp\NC \NC \NR
\NC cswh\NC \*cswh\NC \NC \NR
\NC curs\NC \*curs\NC \NC \NR
\NC dlig\NC \*dlig\NC \NC \NR
\NC dnom\NC \*dnom\NC \NC \NR
\NC expt\NC \*expt\NC \NC \NR
\NC fina\NC \*fina\NC \NC \NR
\NC fin2\NC \*fin2\NC \NC \NR
\NC fin3\NC \*fin3\NC \NC \NR
\NC frac\NC \*frac\NC \NC \NR
\NC fwid\NC \*fwid\NC \NC \NR
\NC haln\NC \*haln\NC \NC \NR
\NC hist\NC \*hist\NC \NC \NR
\NC hkna\NC \*hkna\NC \NC \NR
\NC hlig\NC \*hlig\NC \NC \NR
\NC hngl\NC \*hngl\NC \NC \NR
\NC hwid\NC \*hwid\NC \NC \NR
\NC init\NC \*init\NC \NC \NR
\NC isol\NC \*isol\NC \NC \NR
\NC ital\NC \*ital\NC \NC \NR
\NC jp78\NC \*jp78\NC \NC \NR
\NC jp83\NC \*jp83\NC \NC \NR
\NC jp90\NC \*jp90\NC \NC \NR
\NC kern\NC \*kern\NC \NC \NR
\NC liga\NC \*liga\NC \NC \NR
\NC lnum\NC \*lnum\NC \NC \NR
\NC locl\NC \*locl\NC \NC \NR
\NC mark\NC \*mark\NC \NC \NR
\NC medi\NC \*medi\NC \NC \NR
\NC med2\NC \*med2\NC \NC \NR
\NC mgrk\NC \*mgrk\NC \NC \NR
\NC mkmk\NC \*mkmk\NC \NC \NR
\NC nalt\NC \*nalt\NC \NC \NR
\NC nlck\NC \*nlck\NC \NC \NR
\NC nukt\NC \*nukt\NC \NC \NR
\NC numr\NC \*numr\NC \NC \NR
\NC onum\NC \*onum\NC \NC \NR
\NC ordn\NC \*ordn\NC \NC \NR
\NC ornm\NC \*ornm\NC \NC \NR
\NC pnum\NC \*pnum\NC \NC \NR
\NC pref\NC \*pref\NC \NC \NR
\NC pres\NC \*pres\NC \NC \NR
\NC pstf\NC \*pstf\NC \NC \NR
\NC rlig\NC \*rlig\NC \NC \NR
\NC rphf\NC \*rphf\NC \NC \NR
\NC rtla\NC \*rtla\NC \NC \NR
\NC salt\NC \*salt\NC \NC \NR
\NC sinf\NC \*sinf\NC \NC \NR
\NC smcp\NC \*smcp\NC \NC \NR
\NC smpl\NC \*smpl\NC \NC \NR
\NC ss01\NC \*ss01\NC \NC \NR
\NC ss02\NC \*ss02\NC \NC \NR
\NC ss03\NC \*ss03\NC \NC \NR
\NC ss04\NC \*ss04\NC \NC \NR
\NC ss05\NC \*ss05\NC \NC \NR
\NC ss06\NC \*ss06\NC \NC \NR
\NC ss07\NC \*ss07\NC \NC \NR
\NC ss08\NC \*ss08\NC \NC \NR
\NC ss09\NC \*ss09\NC \NC \NR
\NC subs\NC \*subs\NC \NC \NR
\NC sups\NC \*sups\NC \NC \NR
\NC swsh\NC \*swsh\NC \NC \NR
\NC titl\NC \*titl\NC \NC \NR
\NC tnam\NC \*tnam\NC \NC \NR
\NC tnum\NC \*tnum\NC \NC \NR
\NC trad\NC \*trad\NC \NC \NR
\NC unic\NC \*unic\NC \NC \NR
\NC zero\NC \*zero\NC \NC \NR
\stoptabulate
\stopsimplecolumns
\endgroup
\stopbuffer

\placetable
  [here]
  [tab:mkivfeatures]
  {The OpenType features that are understood by \MKIV\ in \type{mode=node} processing mode}
  {\getbuffer[mkivfeatures]}


\section{Displaying the current font setup}

\macro{\tex{showbodyfont}}
\macro{\tex{showbodyfontenvironment}}

With the command \type {\showbodyfont} an overview is generated of the available 
characters, and an overview of the different fontsizes within a family can be
summoned with \type{\showbodyfontenvironment}.

\showsetup{showbodyfont}

\showsetup{showbodyfontenvironment}


Specifiying actual \type{IDENTIFIER}s to these commands is currently unreliable 
because they internally are still counting on an older system of body font 
definitions, but you can safely use a size argument to get the information 
for the current font set.

Below an example of the possible output is shown, for \type{\showbodyfont[12pt]}  

\showbodyfont[12pt]

And the output of \type{\showbodyfontenvironment[12pt]} is:

\showbodyfontenvironment[12pt]


\section{Math fonts}
\index{math fonts}
\macro{\tex{mf}}

\startbuffer[math-1]
$\tf x^2+\bf x^2+\sl x^2+\it x^2+\bs x^2+ \bi x^2 =\rm 6x^2$
$\tf x^2+\bf x^2+\sl x^2+\it x^2+\bs x^2+ \bi x^2 =\tf 6x^2$
$\tf x^2+\bf x^2+\sl x^2+\it x^2+\bs x^2+ \bi x^2 =\bf 6x^2$
$\tf x^2+\bf x^2+\sl x^2+\it x^2+\bs x^2+ \bi x^2 =\sl 6x^2$
\stopbuffer

\startbuffer[math-2]
$\tf\mf x^2 + x^2 + x^2 + x^2 + x^2 + x^2 = 6x^2$
$\bf\mf x^2 + x^2 + x^2 + x^2 + x^2 + x^2 = 6x^2$
$\sl\mf x^2 + x^2 + x^2 + x^2 + x^2 + x^2 = 6x^2$
$\bs\mf x^2 + x^2 + x^2 + x^2 + x^2 + x^2 = 6x^2$
$\it\mf x^2 + x^2 + x^2 + x^2 + x^2 + x^2 = 6x^2$
$\bi\mf x^2 + x^2 + x^2 + x^2 + x^2 + x^2 = 6x^2$
\stopbuffer

\startbuffer[math-3]
$\bf x^2 + x^2 + x^2 + x^2 + x^2 + x^2 = \mf 6x^2$
\stopbuffer

There are only a few font families in existance that can handle math
properly because such fonts have to carry a complete set of characters and
symbols for mathematical typesetting.  Among these, the Computer
Modern Roman distinguishes itself by its many design sizes; that
really pays off when typesetting complicated math formulas. 


Many \TEX\ users have chosen \TEX\ for its superb math typesetting. 

This chapter will not go into any details but in math mode, the
central concept is the {\em math family} (not to be confused with the
{\em font families} discussed earlier). There are math families for
\type {\bf}, \type {\it}, etc. as well as for the special math
symbols. Within each family, there are always exactly three member
fonts: \type{text}, \type{script} and \type{scriptscript}, or a
normal, smaller and smallest font. The normal font size is used for
running text and the smaller ones for sub and superscripts. The next
example will show what the members of a math family can do.

\typebuffer[math-1]

When this is typeset you see this:

\startlines
\getbuffer[math-1]
\stoplines

As you can see, the alphabetic characters adapt to the selected font
family but the symbols are all typeset in the same font
regardless. Technically this means that the symbols are set in the
fixed font family~0 whereas the alphabetic characters are typeset
using variable family numbers.

Typeseting math formulas can also be done somewhat differently, as we
will see in the next example.

\typebuffer[math-2]

A new command is used: \type {\mf}, which stands for {\em math
font}. This command takes care of the symbols in such a way that they
are also set in the actually selected font, just like the characters.

\startlines
\getbuffer[math-2]
\stoplines

You should take into account that \TEX\ typesets a formula as a
whole. In some cases this means that setups at the end of the formula
have an effect that starts already at the beginning of the fomula.

For example, the exact location of \type {\mf} is not that important.
We also could have typed:

\typebuffer[math-3]

There is much more to be said about math, but it is better to do that
in~\in{chapter}[chap:math], about math.

\section{Em and Ex}
\index[em]{\type{em}}
\index[ex]{\type{ex}}

In specifying dimensions we can distinguish physical units
like \type {pt} and \type {cm} and internal units like \type
{em} and \type {ex}. These last units are related to the
actual fontsize. When you use these internal units in
specifying for example horizontal and vertical spacing you
don't have to do any recalculating when fonts are switched
in the style definition.

Some insight in these units does not hurt. The width of an
\type {em} is not the with of an M, but that of an --- (an
em||dash). When this glyph is not available in the font
another value is used. \in {Table} [ems] shows some
examples. We see that the width of a digit is about \type
{.5em}. In Computer Modern Roman a digit is excactly half
an em wide.

\startbuffer[em-ex-1]

\def\jump{\vl\hskip1em\vl}%
\def\mmmm{\vl M\vl}%
\def\dash{\vl---\vl}%
\def\numb{\vl12\vl}%

\starttable[|c|c|c|c|c|c|]
\HL
\VL \type{\tf} \VL \type{\bf} \VL \type{\sl}  \VL
    \type{\tt} \VL \type{\ss} \VL \type{\tfx} \VL\SR
\HL
\VL \tf\numb   \VL \bf\numb   \VL \sl \numb   \VL
    \tt\numb   \VL \ss\numb   \VL \tfx\numb   \VL\FR
\VL \tf\mmmm   \VL \bf\mmmm   \VL \sl \mmmm   \VL
    \tt\mmmm   \VL \ss\mmmm   \VL \tfx\mmmm   \VL\MR
\VL \tf\jump   \VL \bf\jump   \VL \sl \jump   \VL
    \tt\jump   \VL \ss\jump   \VL \tfx\jump   \VL\MR
\VL \tf\dash   \VL \bf\dash   \VL \sl \dash   \VL
    \tt\dash   \VL \ss\dash   \VL \tfx\dash   \VL\LR
\HL
\stoptable

\stopbuffer

\placetable
  [here][ems]
  {The width of an \type{em}.}
  {\getbuffer[em-ex-1]}

In most cases we use \type{em} for specifying width and and
\type {ex} for height. \in {Table} [exes] shows some
examples. We see that the height equals the height of a
lowercase~x.

\startbuffer[em-ex-2]

\def\show
  {\hbox
    {\forgetall
     \offinterlineskip
     \vbox
       {\hsize1em\hl[1]\endgraf\vskip1ex\hl[1]}%
     \hskip.25em
     \vbox
       {\hsize.5em \vskip\linewidth x\vskip\linewidth}}}%

\starttable[|c|c|c|c|c|c|]
\HL
\VL \type{\tf} \VL \type{\bf} \VL \type{\sl}  \VL
    \type{\tt} \VL \type{\ss} \VL \type{\tfx} \VL\SR
\HL
\VL \tf\show   \VL \bf\show   \VL \sl\show    \VL
    \tt\show   \VL \ss\show   \VL \tfx\show   \VL\SR
\HL
\stoptable

\stopbuffer

\placetable
  [here][exes]
  {The height of an \type{ex}.}
  {\getbuffer[em-ex-2]}


\section {Font handling}

In the following fake paragraph, you can see a hyphenation
point, a secondary sentence, separated by a comma, and a
last sentence, ending with a period. Miraculously, this
paragraph fits into lines. Although exaggerated, these lines
demonstrate that visually the hyphen and punctuation
characters make the margin look ragged.

\FakeParagraph\hbox\relax

Before computers started to take over the traditional
typesetter's job, it was common practice to move hyphens and
punctuation into the margin, like in:

\FakeParagraph\rlap\relax

In this alternative, the margin looks less ragged, and this
becomes more noticable once you get aware of this phenomenon.

Sometimes, shifting the characters completely into the
margin is too much for the sensitive eye, for instance with
a slanted font, where the characters already hang to the
right. In such cases, we need to compromise.

\FakeParagraph{\hbox to .2ex}\rlap

\PDFTEX\ (and \LUATEX\ inherits this feature) has provisions 
to move characters into the margin 
when they end up at the end of a line. Such characters are
called protruding characters. \PDFTEX\ takes protruding
into account when breaking a paragraph. 
%\footnote {One can
%also protrude characters without interference with the
%breaking routines, but since we consider this less good,
%\CONTEXT\ simply does not support it.}

We demonstrate protruding using a quote from Hermann Zapf's
article \quotation {About micro||typography and the {\sl
hz}||program} in Electronic Publishing, vol~6~(3), 1993.

%\bgroup
%\switchtobodyfont[modern,9pt] \noindent \input zapf \par
%\egroup

\startnarrower
\switchtobodyfont[modern,9pt] 
\typefile{zapf}
\stopnarrower

After \TEX\ has typeset this paragraph (using a specific font size
and line width) it may have constructed the following lines.

\blank

\beginofshapebox
\switchtobodyfont[modern,9pt] \noindent \input zapf \par
\endofshapebox
\reshapebox{\hbox{\AltColor\ruledhbox{\black\box\shapebox}}}
\flushshapebox

\blank

As you can see, the height and depth of the lines depend on
the characters, but their width equals what \TEX\ calls
\type {\hsize}. However, the natural width of the lines may
differ from \type {\hsize}.

\blank

\beginofshapebox
\switchtobodyfont[modern,9pt] \noindent \input zapf \par
\endofshapebox
\reshapebox{\hbox{\AltColor\ruledhbox{\black\unhbox\shapebox}}}
\flushshapebox

\blank

Here the inter||word space is fixed to what \TEX\ considers
to be a space. This example also demonstrates that \TEX\
does not have spaces, but stretches the white area between
words to suit its demands. When breaking lines, \TEX's mind
is occupied by boxes, glue and penalties, or in more common
language: (parts of) words, stretchable white space, and more
or less preferred breakpoints.


\fixme{either there is no protrusion in \MKIV\ yet and these examples 
have to changed into external figures, or \MKIV\ uses a different
syntax that I do not know}

\blank

\bgroup
\def\postprocesscolumnbox#1{\hbox{\AltColor\ruledhbox{\black\box#1}}}
\startcolumns[n=3]
\setupfontsynonym [Serif] [handling=normal] % [pure]
\setupalign[verytolerant,stretch,hanging]
\switchtobodyfont[modern,9pt] \noindent \input zapf \par
\stopcolumns
\egroup

\blank

This time we have enabled \PDFTEX's protruding mechanism.
The characters that stick into the margin are taken into
account when breaking the paragraph into lines, but in the
final result, they do not count in the width. Here we used
an ugly three column layout so that we got a few more
hyphens to illustrate the principle, but in the next
examples we will stick to two columns.

\blank

\startcolumns[n=2]
\setupalign[verytolerant,stretch]
\switchtobodyfont[modern,9pt] \noindent \input zapf \par
\stopcolumns

\blank

In this first example we just typeset the text in the
traditional way. The hyphens and punctuation fit into the
margin.

\blank

\startcolumns[n=2]
\setupfontsynonym [Serif] [handling=pure]
\setupalign[verytolerant,stretch,hanging]
\switchtobodyfont[modern,9pt] \noindent \input zapf \par
\stopcolumns

\blank

In this example, the protruding machinery is put to labour.
The hyphens and punctuation may now stick into the margin
completely. The next two examples shows what happens when we
limit the protruding to 75\% and 50\% respectively.

\blank

\startcolumns[n=2]
\setupfontsynonym [Serif] [handling=pure]
\setupfonthandling[normal][left=.75,right=.75]
\setupalign[verytolerant,stretch,hanging]
\switchtobodyfont[modern,9pt] \noindent \input zapf \par
\stopcolumns

\blank

\startcolumns[n=2]
\setupfontsynonym [Serif] [handling=pure]
\setupfonthandling[normal][left=.5,right=.5]
\setupalign[verytolerant,stretch,hanging]
\switchtobodyfont[modern,9pt] \noindent \input zapf \par
\stopcolumns

\blank

Although available in \PDFTEX, this feature is not limited
to \PDF\ output. If this may comfort you: when protruding
is not enabled the output is 100\% identical.


\fixme{In \CONTEXT\ \MKIV, font handling is merged with font features,
so the rest of this section seems to only apply to \PDFTEX}

Since protruding is related to the shape of the font, in
\PDFTEX\ setting it up takes place in a similar way as encoding, like so:

\starttyping
\definefontsynonym
  [myfont] [Serif] [handling=pure]
\stoptyping

We can also specify a handler at a higher level of
abstraction:

\starttyping
\setupfontsynonym [Lucida-Bright] [handling=pure]
\stoptyping

Or even:

\starttyping
\setupfontsynonym [Serif] [handling=pure]
\stoptyping


The values that \THANH\ mentions in his thesis, are
available under the names \type {punctuation} and \type
{alpha}:

\starttabulate[|lT|l|]
\HL
\NC \rm\bf vector \NC \bf protruding character set \NC \NR
\HL
\NC punctuation \NC hyphenation and punctuation characters \NC \NR
\NC alpha       \NC the latin alphabet characters          \NC \NR
\NC extended    \NC the other characters                   \NC \NR
\HL
\stoptabulate

The \type {extended} category maps the special characters onto the
base 26 ones, and thereby honors the font encoding vector. This
mapping vector can be used to enhance other handling vectors with
support for accented characters (in most cases \aacute, \agrave,
etc.\ need a treatment similar to~a).

The default punctuation vector looks like this:

\starttyping
\startfonthandling[punctuation]
  \defineprotrudefactor ,  0  .7
  \defineprotrudefactor .  0  .7
  \defineprotrudefactor :  0  .5
  \defineprotrudefactor ;  0  .5
  .....
\stopfonthandling
\stoptyping

Equaly valid are definitions like:

\starttyping
\defineprotrudefactor hyphen 0 .7
\stoptyping

Any character can protrude:

\starttyping
\defineprotrudefactor A .05 .05
\stoptyping

For convenience we let composed characters inherit the
values from their parents.

\starttyping
\inheritprotrudefactor Acircumflex A
\stoptyping

Instead of using numbers (like the 700 in the previous
definition), we use fractions, one for the left and one for the
right shift. There are a few more vectors defined, like \type
{defalph} for characters, where we only apply very small shifts.

A combination of such vectors is packaged in a font handler
using the following command:

\starttyping
\definefonthandling [normal] [punctuation,alpha]
\stoptyping

These definitions depend on the encoding, they are
loaded with the \type {\usehandling} command. You can for
instance load the default definitions with: :

\starttyping
\usehandling[def]
\stoptyping

Since this vector is already preloaded in \CONTEXT, you
normally don't have to provide this command.

In \CONTEXT\ we have integrated protruding characters
(hanging punctuation) into the normal alignment macros.

\starttyping
\setupalign[hanging]
\stoptyping

Font protruding is turned off automatically in controlled
situations, and more control will be added in due time. We
already mentioned that the amount of protruding depends on
the shape, which is why we may need different values for
slanted and bold shapes. One way of using the same vector for
different shapes, is changing the strength of the protruding:

\starttyping
\definefonthandling [slanted] [punctuation] [right=1.5]
\stoptyping

Here, because a slanted glyph already sticks into the
margin, we limit protruding to punctuation. You may expect
more (probably incompatible) fine tuning in the future. For
the moment, when you want to play safe, the most simple way
to enable hanging punctuation is to use the predefined
typescript:

\starttyping
\usetypescript [serif,sans,mono] [hanging] [pure]
\setupalign[hanging]
\stoptyping

or even:

\starttyping
\setupfontsynonym [handling=pure] \setupalign[hanging]
\stoptyping

In addition to these two handlings (hz and protruding) \CONTEXT\
also provides the \type {noligs} handling (handy when one
processes \XML), \type {flexspacing} and \type {prespacing}
(meant for languages like French that need spacing around for
instance \type {:} and~\type {;}). These handlings are somewhat
experimental.


\section [sec:encodings]{Encodings and mappings}

This paragraph only applies to \PDFTEX. If you are exclusively using
\XETEX\ or \MKIV, you can safely ignore the following text.

Not every language uses the (western) latin alphabet. Although
in most languages the basic 26 characters are somehow used,
they can be combined with a broad range of accents placed in
any place.

In order to get a character representation, also called
glyph, in the resulting output, you have to encode
it in the input. This is no problem for \type {a..z}, but
other characters are accessed by name, for instance \type
{\eacute}. The glyph \eacute\ can be present in the font but when
it's not there, \TEX\ has to compose the character from a
letter~e and an accent~\textgrave.

In practice this means that the meaning of \type {\eacute}
depends on the font and font encoding used. There are many
such encodings, each suited for a subset of languages.

\vskip 1ex
\starttabulate [|lT|p|l|]
\HL
\NC \rm\bf encoding \NC \bf usage \NC \bf status \NC \NR
\HL
\NC 8r        \NC a (strange) mixture of encodings                            \NC useless  \NC \NR
\NC default   \NC the 7 bit \ASCII\ encoding as used by plain \TEX            \NC obsolete \NC \NR
\NC ec        \NC the prefered encoding of \TEX\ distributions                \NC okay     \NC \NR
\NC greek     \NC an encoding for modern greek                                \NC okay     \NC \NR
\NC qx        \NC an encoding that covers most eastern european languages     \NC okay     \NC \NR
\NC t2a       \NC a cyrillic \TEX\ font encoding                              \NC ?        \NC \NR
\NC t2b       \NC another cyrillic \TEX\ font encoding                        \NC ?        \NC \NR
\NC t2c       \NC another another cyrillic \TEX\ font encoding                \NC ?        \NC \NR
\NC t5        \NC an encoding dedicated to vietnamese (many (double) accents) \NC okay     \NC \NR
\NC texnansi  \NC a combination of \TEX\ and Adobe standard encoding          \NC okay     \NC \NR
\HL
\stoptabulate
\vskip 1ex

These encodings are font related as is demonstrated in \in
{figure} [fig:font a], \in{}[fig:font b],  \in{}[fig:font c], \in
{and} [fig:font d]. Here we used the \type {\showfont} command.

\definefontsynonym [TestA] [ec-lmr10]       [encoding=ec]
\definefontsynonym [TestB] [texnansi-lmr10] [encoding=texnansi]
\definefontsynonym [TestC] [qx-lmr10]       [encoding=qx]
\definefontsynonym [TestD] [t5-lmr10]       [encoding=t5]

\placefigure
  [here][fig:font a]
  {The Latin Modern Roman font in ec encoding.}
  {\scale[width=\textwidth]{\showfont[TestA]}}

\placefigure
  [here][fig:font b]
  {The Latin Modern Roman font in texnansi encoding.}
  {\scale[width=\textwidth]{\showfont[TestB]}}

\placefigure
  [here][fig:font c]
  {The Latin Modern Roman font in qx encoding.}
  {\scale[width=\textwidth]{\showfont[TestC]}}

\placefigure
  [here][fig:font d]
  {The Latin Modern Roman font in t5 encoding.}
  {\scale[width=\textwidth]{\showfont[TestD]}}

The situation is even more complicated than it looks, since
the font may be virtual, that is, built from several fonts.

The advantage of using specific encodings is that you can
let \TEX\ hyphenate words in the appropriate way. The
hyphenation patterns are applied to the internal
data structures that represent the sequence of glyphs. In
spite of what you may expect, they are font||dependent! Even
more confusing: they not only depend on the font encoding,
but also on the mapping from lower to uppercase characters,
or more precise, on the existence of such a mapping.

Unless you want to play with these encodings and mappings,
in most cases you can forget their details and rely on what
other \TEX\ experts tell you to do. Normally switching from
one to another encoding and|/|or mapping takes place with the
change in fonts or when some special output encoding is
needed, for instance in \PDF\ annotations and|/|or unicode
vectors that enable searching in documents. So, to summarize
this: encodings and mappings depend on the fonts used as well
have consequences for the language specific hyphenation
patterns. Fortunately \CONTEXT\ handles this for you
automatically.

If you want to know to what extent a font is complete and
characters need to be composed on the fly, you can typeset a
a couple of tables. The (current) composition is shown by
\type {\showaccents}:

\showaccents

with \type {\showcharacters}, you get a list of named
characters (and glyphs) as known to the system.

\showcharacters

If you want to know what patterns are used, you can try to
hyphenate a word with \type {\showhyphenations}.

\showhyphenations{abracadabra}

\stopcomponent
